(function(global){'use strict';global.setupCategoryPickerWidget=function setupCategoryPickerWidget(options){options=$.extend(true,{fieldId:null,navigatorCategoryId:null,requireEventCreationRights:false,allow:{events:true,subcats:true}},options);var $field=$('#'+options.fieldId);var $categoryTitle=$('#category-title-'+options.fieldId);var $dialogTrigger=$('#categorynav-button-'+options.fieldId);var hiddenData=$field.val()?JSON.parse($field.val()):{};var navigatorCategory=options.navigatorCategoryId;var actionOn={};if(options.requireEventCreationRights){actionOn.categoriesWithoutEventCreationRights={disabled:true};}
if(!options.allow.events){actionOn.categoriesWithEvents={disabled:true};}
if(!options.allow.subcats){actionOn.categoriesWithSubcategories={disabled:true};}
if(hiddenData){$categoryTitle.text(hiddenData.title);$field.val(JSON.stringify(hiddenData));}
$.ajax({url:build_url(Indico.Urls.Categories.info,{category_id:navigatorCategory}),dataType:'json',error:handleAjaxError,success:function(data){navigatorCategory=data;}});$dialogTrigger.on('click',function(evt){evt.preventDefault();$('<div>').categorynavigator({category:navigatorCategory,openInDialog:true,actionOn:actionOn,onAction:function(category){var event=$.Event('indico:categorySelected');var dfd=$.Deferred();$categoryTitle.text(category.title);hiddenData={id:category.id,title:category.title};navigatorCategory=category.id;$field.val(JSON.stringify(hiddenData)).trigger('change').trigger(event,[category,dfd]);if(event.isDefaultPrevented()){return dfd;}}});});};})(window);(function(global){'use strict';global.setupCKEditorWidget=function setupCKEditorWidget(options){options=$.extend(true,{fieldId:null,simple:false,images:false,height:475},options);var field=$('#'+options.fieldId);var editor=new RichTextEditor(600,options.height,options.simple,options.images);editor.set(field.val());editor.onLoad(function(){editor.onChange(function(){field.val(editor.get()).trigger('change');});});$E(options.fieldId+'-editor').set(editor.draw());var dialog=field.closest('.ui-dialog-content');if(dialog.length){dialog.dialog('option','position',dialog.dialog('option','position'));}};})(window);(function(global){'use strict';global.setupColorPickerWidget=function setupColorPickerWidget(options){options=$.extend(true,{fieldId:null},options);var field=$('#'+options.fieldId);field.closest('.i-color-field').colorpicker();field.clearableinput();};})(window);(function(global){'use strict';global.setupDateTimeWidget=function setupDateTimeWidget(options){options=$.extend(true,{fieldId:null,timezoneFieldId:null,timezone:null,defaultTime:null,hasData:false,earliest:{date:null,time:null},latest:{date:null,time:null},linkedField:{id:null,notBefore:false,notAfter:false}},options);var dateField=$('#'+options.fieldId+'-date');var timeField=$('#'+options.fieldId+'-time');var resetFieldAction=$('#'+options.fieldId+'-reset');var timezoneElement=timeField.next('.timezone');var timezone=options.timezone;var initialDate,initialTime;function clearDate(){dateField.datepicker('setDate',null).trigger('change');}
function initTime(){if(timeField.val()===''){timeField.val(options.defaultTime);}}
function updateDateRequired(e){dateField.prop('required',e.target.value!=='');}
function updateTimeRequired(e){timeField.prop('required',e.target.value!=='');}
function updateResetFieldAction(){var isVisible=!!(dateField.val()||timeField.val());resetFieldAction.toggle(isVisible);}
function updateTimeLimits(selectedDate,limitDate,limitTime,attr){var selectedTime=timeField.val();if(selectedDate!==limitDate||(selectedDate===initialDate&&selectedTime===initialTime)){timeField.removeAttr(attr);}else if(timeField.attr(attr)!==limitTime){setTimeout(function(){timeField.attr(attr,limitTime);},1000);}}
function updateDateLimits(selectedDate){if(options.linkedField.notBefore){dateField.datepicker('option','minDate',selectedDate);}
if(options.linkedField.notAfter){dateField.datepicker('option','maxDate',selectedDate);}}
function updateMaxTime(selectedDate){updateTimeLimits(selectedDate,options.latest.date,options.latest.time,'max');}
function updateMinTime(selectedDate){updateTimeLimits(selectedDate,options.earliest.date,options.earliest.time,'min');}
timezoneElement.qtip({content:{text:function(){return timezone;}}});if(options.timezoneFieldId){$('#'+options.timezoneFieldId).on('change',function(){timezone=$(this).val();});}
dateField.datepicker({onSelect:function applyOnSelectHandlers(){var $this=$(this);var handlers=$this.data('onSelectHandlers');for(var i=0;i<handlers.length;i++){handlers[i].apply(this,arguments);}
$this.blur();}}).data('onSelectHandlers',[initTime,function(){dateField.trigger('change');}]).on('change',function(e){updateTimeRequired(e);updateResetFieldAction();});timeField.on('change',function applyOnChangeHandlers(){var handlers=$(this).data('onChangeHandlers');for(var i=0;i<handlers.length;i++){handlers[i].apply(this,arguments);}}).data('onChangeHandlers',[updateDateRequired,updateResetFieldAction]);if(options.hasData){initialDate=dateField.val()||undefined;initialTime=timeField.val()||undefined;dateField.datepicker('setDate',initialDate);dateField.trigger('change');timeField.trigger('change');}
if(options.earliest){dateField.datepicker('option','minDate',options.earliest.date);dateField.datepicker().data('onSelectHandlers').push(updateMinTime);timeField.data('onChangeHandlers').push(function(){var selectedDate=moment(dateField.datepicker('getDate'));updateMinTime(selectedDate.format('DD/MM/YYYY'));});if(initialDate){updateMinTime(initialDate);}}
if(options.latest){dateField.datepicker('option','maxDate',options.latest.date);dateField.datepicker().data('onSelectHandlers').push(updateMaxTime);timeField.data('onChangeHandlers').push(function(){var selectedDate=moment(dateField.datepicker('getDate'));updateMaxTime(selectedDate.format('DD/MM/YYYY'));});if(initialDate){updateMaxTime(initialDate);}}
if(options.linkedField){var linkedDateField=$('#'+options.linkedField.id+'-date');linkedDateField.datepicker().data('onSelectHandlers').push(updateDateLimits);updateDateLimits(linkedDateField.datepicker('getDate'));}
resetFieldAction.on('click',function resetDateTime(){timeField.val('').trigger('change');clearDate();});};})(window);(function(global){'use strict';global.setupLinkingWidget=function setupLinkingWidget(options){options=$.extend(true,{fieldId:null},options);function updateDropdownState(){var $this=$(this);if($this.prop('checked')){$this.closest('.i-radio').siblings('.i-radio').find('.i-linking-dropdown select').prop('disabled',true);$this.siblings('.i-linking-dropdown').find('select').prop('disabled',false);}}
var field=$('#'+options.fieldId);field.find('.i-linking > .i-linking-dropdown > select > option[value=""]').prop('disabled',true);field.find('.i-linking.i-radio > input[type="radio"]').off('change').on('change',updateDropdownState).each(updateDropdownState);};})(window);(function(global){'use strict';global.setupLocationWidget=function setupLocationWidget(options){options=$.extend(true,{fieldId:null,inheritanceAllowed:false,venues:null,venueNames:null,venueMap:null,rooms:null,inheritedLocationData:null,parent:{type:'',title:''}},options);var field=$('#'+options.fieldId);var helperText=field.closest('.form-field').find('.location-inheritance-field .info-helper');var venueInput=$('#location-venue-'+options.fieldId);var roomInput=$('#location-room-'+options.fieldId);var address=$('#location-address-'+options.fieldId);var usingDefault=$('#location-inheritance-'+options.fieldId);var hiddenData=field.val()?JSON.parse(field.val()):{};var latestUsedField=null;var currentScrollPos=0;var delta=0;var validRoom=false;var validVenue=false;var preventGuessing=false;var roomJustCleared=false;var venueJustChanged=false;function initializeInputs(){address.val(hiddenData.address);roomInput.val(hiddenData.room_name);venueInput.val(hiddenData.venue_name);if(hiddenData.venue_id){highlightOption(venueInput,venueInput.val());}
if(hiddenData.room_id){highlightOption(roomInput,roomInput.val());}
if(options.inheritanceAllowed){usingDefault.prop('checked',hiddenData.inheriting);}}
function toggleDefaultLocation(isChecked,isInitStep){if(!options.inheritanceAllowed){return;}
var message=$T.gettext('Using default location from: {0} ({1})').format(options.parent.title,options.parent.type);var text=isChecked?message:$T.gettext('Using custom location');helperText.attr('title',text);venueInput.prop('disabled',isChecked).toggleClass('disabled',isChecked);roomInput.prop('disabled',isChecked).toggleClass('disabled',isChecked);address.prop('disabled',isChecked).toggleClass('disabled',isChecked);field.closest('.i-location-field').toggleClass('disabled',isChecked);hiddenData.inheriting=isChecked;field.val(JSON.stringify(hiddenData));if(options.inheritedLocationData!==null){if(!isInitStep){if(isChecked){hiddenData=$.extend({},options.inheritedLocationData);hiddenData.inheriting=true;initializeInputs();}else{clearField(venueInput);address.val('');delete hiddenData.address;}
field.val(JSON.stringify(hiddenData)).trigger('change');}}}
function reorderCategories(venueName){var groupOrder=[venueName];for(var i=options.venueNames.length-1;i>=0;i--){if(!~groupOrder.indexOf(options.venueNames[i])){groupOrder.push(options.venueNames[i]);}}
global.Typeahead[roomInput.selector].options.groupOrder=groupOrder;}
function updateVenueOnRoomChange(item){if(item.venue_id!=hiddenData.venue_id){venueJustChanged=true;var venueName=item.group||options.venueMap[item.venue_id];var data={item_name:venueName,venue_id:item.venue_id,room_id:item.id};venueInput.val(venueName).trigger('typeahead:click-on-option',data);}}
function clearRoom(){delete hiddenData.room_id;delete hiddenData.room_name;roomInput.val('');roomInput.siblings('.keyword-highlighter').removeClass('visible');roomJustCleared=true;postSelectionActions(roomInput,'');}
function clearVenue(){delete hiddenData.venue_id;delete hiddenData.venue_name;venueInput.val('');venueInput.siblings('.keyword-highlighter').removeClass('visible');venueJustChanged=true;postSelectionActions(venueInput,'');clearRoom();}
function clearField(field){if(field[0].id==venueInput[0].id){clearVenue();}else if(field[0].id==roomInput[0].id){clearRoom();}}
function updateResultsList(node,resultHtmlList){var resultsWrapper=node.siblings('.typeahead__result');resultsWrapper.css('top',node.outerHeight()+'px');var justUse=node.parent().find('.just-use-option');if(node.val()){if(!justUse.length){justUse=$('<div>',{'class':'just-use-option'});var justUseLink=$('<a>').on('click',function(){node.trigger('typeahead:click-on-custom-option',{item_name:node.val()});});justUse.append(justUseLink);resultsWrapper.append(justUse);}
justUse.find('a').text($T.gettext('Just use "{0}"').format(node.val()));}else{justUse.remove();}
var firstOption=resultHtmlList.find('li.typeahead__item').first();if(!firstOption.length){node.parent().find('.just-use-option').addClass('active');}else{resultHtmlList.find('li.typeahead__item').first().addClass('active');}
return resultHtmlList;}
function scrollResultsList(inputField){var parent=inputField.parent();var activeOption=parent.find('.typeahead__result').find('.typeahead__item.active');var dropdownList=parent.find('.typeahead__list');if(activeOption.length!=0){if(activeOption.position().top+activeOption.outerHeight()>dropdownList.outerHeight()){delta=activeOption.position().top+activeOption.outerHeight()-dropdownList.outerHeight();currentScrollPos+=delta;dropdownList.animate({scrollTop:currentScrollPos},50);}else if(activeOption.position().top<dropdownList.position().top){currentScrollPos+=activeOption.position().top;dropdownList.animate({scrollTop:currentScrollPos},50);}}
parent.find('.just-use-option').toggleClass('active',!activeOption.length);}
function postSelectionActions(inputField,value){field.val(JSON.stringify(hiddenData)).trigger('change');if(inputField[0].id==venueInput[0].id){latestVenueValue=value;}else if(inputField[0].id==roomInput[0].id){latestRoomValue=value;}}
function highlightOption(inputField,value){var highlighter=inputField.siblings('.keyword-highlighter');highlighter.html(value).addClass('visible');}
function cleanQuery(query){return query?query.trim():'';}
function findRoomInVenue(query,venue){if(options.rooms[venue]){return $.grep(options.rooms[venue].data,function(room){return room.name.toUpperCase()==query.toUpperCase();});}
return[];}
function toggleOpenResultsList(inputField){if(inputField[0].id==venueInput[0].id&&roomInput.closest('.typeahead__container').hasClass('result')){roomInput.trigger('typeahead:close-results-list');}else if(inputField[0].id==roomInput[0].id&&venueInput.closest('.typeahead__container').hasClass('result')){venueInput.trigger('typeahead:close-results-list');}}
function resetSelectedOption(){if(latestUsedField[0].id==venueInput[0].id){validVenue=true;venueInput.val(latestVenueValue);if(hiddenData.venue_id){highlightOption(venueInput,latestVenueValue);}}else if(latestUsedField[0].id==roomInput[0].id){validRoom=true;roomInput.val(latestRoomValue);if(hiddenData.room_id){highlightOption(roomInput,latestRoomValue);}}}
function handleKeystrokes(node){node.on('keydown',function(evt){var $this=$(this);var typeaheadField=$this.parent();var resultsAreOpen=typeaheadField.parent().hasClass('result');var activeItem=typeaheadField.find('.active');if((evt.keyCode==K.TAB||evt.keyCode==K.ENTER)&&activeItem.length&&resultsAreOpen){preventGuessing=true;if(evt.keyCode==K.ENTER){evt.preventDefault();}
evt.stopImmediatePropagation();activeItem.find('a').click();}
else if(evt.keyCode==K.TAB&&node.val()){evt.stopImmediatePropagation();}
else if(evt.keyCode==K.ESCAPE){evt.preventDefault();evt.stopImmediatePropagation();resetSelectedOption();$this.trigger('typeahead:close-results-list');}});}
initializeInputs();var latestVenueValue=venueInput.val();var latestRoomValue=roomInput.val();if(options.inheritanceAllowed){usingDefault.on('click',function(){toggleDefaultLocation(this.checked);});toggleDefaultLocation(usingDefault.prop('checked'),true);}
venueInput.typeahead({source:options.venues,minLength:0,searchOnFocus:true,resultContainer:'#'+venueInput.siblings('.typeahead__result').find('.results-list-container').attr('id'),template:'<span id="location-venue-{{id}}">{{name}}</span>',emptyTemplate:function(){return'';},display:'name',hint:true,cancelButton:false,callback:{onInit:function(node){this.query=this.rawQuery=node.val();handleKeystrokes(node);},onClickBefore:function(){validVenue=true;},onClickAfter:function(node,a,item){venueInput.trigger('typeahead:click-on-option',{item_name:item.name,venue_id:item.id});},onLayoutBuiltBefore:function(node,query,result,resultHtmlList){return updateResultsList(node,resultHtmlList);},onSearch:function(node,query){this.query=cleanQuery(query);},onShowLayout:function(){toggleOpenResultsList(this.node);venueInput.siblings('.keyword-highlighter').removeClass('visible');currentScrollPos=0;},onHideLayout:function(node){var venueValue=venueInput.val();if(!validVenue&&node.val()&&!preventGuessing){var result=$.grep(options.venues.data,function(venue){return venue.name.toUpperCase()==venueValue.toUpperCase();});if(result.length){venueInput.trigger('typeahead:click-on-option',{item_name:result[0].name,venue_id:result[0].id});}else{venueInput.trigger('typeahead:click-on-custom-option',{item_name:venueValue});}}else if(!node.val()){clearField(venueInput);}
preventGuessing=false;validVenue=false;},onResult:function(node,query,result,resultCount){node.parent().find('.just-use-option').toggleClass('active',!resultCount);}}});roomInput.typeahead({source:options.rooms,minLength:0,searchOnFocus:true,group:true,hint:true,cancelButton:false,maxItem:0,resultContainer:'#'+roomInput.siblings('.typeahead__result').find('.results-list-container').attr('id'),template:'<span id="location-room-{{id}}">{{name}}</span>',emptyTemplate:function(){return'';},display:'name',callback:{onInit:function(node){this.query=this.rawQuery=node.val();handleKeystrokes(node);},onClickBefore:function(){validRoom=true;},onClickAfter:function(node,a,item){roomInput.trigger('typeahead:click-on-option',item);},onLayoutBuiltBefore:function(node,query,result,resultHtmlList){return updateResultsList(node,resultHtmlList);},onSearch:function(node,query){this.query=cleanQuery(query);},onShowLayout:function(){toggleOpenResultsList(this.node);roomInput.siblings('.keyword-highlighter').removeClass('visible');currentScrollPos=0;},onHideLayout:function(node){if(!validRoom&&node.val()&&!preventGuessing){var result=[];var venueValue=venueInput.val();var roomValue=roomInput.val();if(venueValue){result=findRoomInVenue(roomValue,venueValue);}else{for(var i=0;i<options.venueNames.length&&!result.length;i++){result=findRoomInVenue(roomValue,options.venueNames[i]);}}
if(result.length){roomInput.trigger('typeahead:click-on-option',result[0]);}else{roomInput.trigger('typeahead:click-on-custom-option',{item_name:roomValue});}}else if(!node.val()){clearField(roomInput);}
preventGuessing=false;validRoom=false;},onResult:function(node,query,result,resultCount){node.parent().find('.just-use-option').toggleClass('active',!resultCount);}}});venueInput.on('typeahead:click-on-option',function(e,data){reorderCategories(data.item_name);if(hiddenData.venue_id&&data.venue_id!=hiddenData.venue_id&&!data.room_id){clearField(roomInput);}
hiddenData.venue_name=data.item_name;hiddenData.venue_id=data.venue_id;postSelectionActions(venueInput,data.item_name);highlightOption(venueInput,data.item_name);venueInput.attr('title',data.item_name);}).on('typeahead:click-on-custom-option',function(e,data){if(hiddenData.room_id){clearField(roomInput);}
delete hiddenData.venue_id;hiddenData.venue_name=data.item_name;postSelectionActions(venueInput,data.item_name);venueInput.val(data.item_name);validVenue=true;venueInput.attr('title',data.item_name);venueInput.focus();venueInput.trigger('typeahead:close-results-list');});roomInput.on('typeahead:click-on-option',function(e,data){updateVenueOnRoomChange(data);hiddenData.room_id=data.id;delete hiddenData.room_name;postSelectionActions(roomInput,data.name);highlightOption(roomInput,data.name);roomInput.attr('title',data.name);}).on('typeahead:click-on-custom-option',function(e,data){delete hiddenData.room_id;hiddenData.room_name=data.item_name;postSelectionActions(roomInput,data.item_name);roomInput.val(data.item_name);validRoom=true;roomInput.attr('title',data.item_name);roomInput.focus();roomInput.trigger('typeahead:close-results-list');});$('#'+options.fieldId+'-wrapper .i-location-input-field').on('typeahead:close-results-list',function(){global.Typeahead["#"+this.id].hideLayout();}).on('typeahead:open-results-list',function(){global.Typeahead["#"+this.id].showLayout();}).on('focus.typeahead',function(){var $this=$(this);if(roomJustCleared&&$this[0].id==roomInput[0].id){$this.trigger('input.typeahead');roomJustCleared=false;}
if(venueJustChanged&&$this[0].id==venueInput[0].id){$this.trigger('input.typeahead');venueJustChanged=false;}
field.closest('.ui-dialog-content').css('overflow','inherit');field.closest('.exclusivePopup').css('overflow','inherit');latestUsedField=$(this);}).on('keydown',function(evt){if(~[K.UP,K.DOWN].indexOf(evt.keyCode)){var $this=$(this);scrollResultsList($this);$this.trigger('focus.typeahead');}}).on('click',function(){if(!$(this).closest('.typeahead__container').hasClass('result')){$(this).trigger('focus.typeahead').trigger('input');}});$('#'+options.fieldId+'-wrapper .toggle-results-list').on('click',function(){var container=$(this).parent().parent();var input=container.find('.i-location-input-field').eq(0);input.trigger(container.hasClass('result')?'typeahead:close-results-list':'focus.typeahead');});address.on('keyup input',function(){hiddenData.address=address.val();field.val(JSON.stringify(hiddenData)).trigger('change');});$('#'+options.fieldId+'-wrapper .keyword-highlighter').on('click',function(){$(this).parent().find('.i-location-input-field').eq(0).trigger('focus.typeahead');});};})(window);(function(global){'use strict';function getLimitClass(remaining,max){if(remaining<0){return'limit-exceeded';}else if(remaining<=max*0.2){return'limit-close';}else{return'';}}
function updateLimits($field,options){var $maxLengthInfo=$('#{0}-max-length-info'.format(options.fieldId));var value=$field.val().trim();$maxLengthInfo.empty();if(options.maxLength){var charsLeft=options.maxLength-value.length;$('<span>',{html:$T.ngettext('<strong>1</strong> char left','<strong>{0}</strong> chars left',charsLeft).format(charsLeft),class:getLimitClass(charsLeft,options.maxLength)}).appendTo($maxLengthInfo);}
if(options.maxWords){var wordCount=countWords(value);var wordsLeft=options.maxWords-wordCount;$('<span>',{html:$T.ngettext('<strong>1</strong> word left','<strong>{0}</strong> words left',wordsLeft).format(wordsLeft),class:getLimitClass(wordsLeft,options.maxWords)}).appendTo($maxLengthInfo);}}
function setupHelpTooltips($field){var $container=$field.closest('[data-field-id]');['markdown-info','latex-info','wmd-help-button'].forEach(function(name){var content=$container.find('.{0}-text'.format(name));$container.find('.'+name).qtip({content:content.html(),hide:{event:'unfocus'},show:{solo:true},style:{classes:'informational markdown-help-qtip'}}).on('click',function(evt){evt.preventDefault();});});}
global.setupMarkdownWidget=function setupMarkdownWidget(options){options=$.extend(true,{fieldId:null,useMarkdownEditor:false,maxLength:0,maxWords:0},options);if(options.useMarkdownEditor){var $field=$('#'+options.fieldId);$field.pagedown();if(options.maxLength||options.maxWords){updateLimits($field,options);$field.on('change input',function(){updateLimits($(this),options);});}
$field.on('focusin',function(){$field.parent().addClass('focused');}).on('focusout',function(){$field.parent().removeClass('focused');});setupHelpTooltips($field);}};})(window);(function(global){'use strict';global.setupMultipleItemsWidget=function setupMultipleItemsWidget(options){options=$.extend(true,{fieldId:null,uuidField:null,columns:null,sortable:false,columnChoices:null},options);var widget=$('#'+options.fieldId+'-widget');var widgetBody=widget.children('table').children('tbody');var field=$('#'+options.fieldId);var data=JSON.parse(field.val());var addButton=$('#'+options.fieldId+'-add-button');var deleteButton=$('<a>',{class:'action-icon icon-remove js-remove-row',href:'#',title:$T('Delete')});var saveButton=$('<a>',{class:'action-icon icon-floppy js-save-row',href:'#',title:$T('Save')});var editButton=$('<a>',{class:'action-icon icon-edit js-edit-row',href:'#',title:$T('Edit')});var cancelButton=$('<a>',{class:'action-icon icon-close js-cancel-edit',href:'#',title:$T('Cancel')});var initialIndex;if(!data.length){createRow();}
data.forEach(function(item){createRow(item);});if(options.sortable){fixWidths();widget.find('tbody').sortable({axis:'y',containment:'parent',cursor:'move',distance:10,handle:'.sort-handle',items:'> tr',tolerance:'pointer',forceHelperSize:true,forcePlaceholderSize:true,helper:function(e,item){var originals=item.children();var helper=item.clone();helper.children().each(function(i){$(this).width(originals.eq(i).width());});return helper;},start:function(e,ui){initialIndex=ui.item.index();},update:function(e,ui){_.move(data,initialIndex,ui.item.index());updateField();}});}
widget.on('click','.js-remove-row',function(e){e.preventDefault();removeRow($(this).closest('tr'));}).on('click','.js-save-row',function(e){e.preventDefault();var row=$(this).closest('tr');var item={};var requiredFieldIsEmpty=false;var invalidNumber=false;if(options.uuidField&&row.data('uuid')){item[options.uuidField]=row.data('uuid');}
options.columns.forEach(function(col,i){var inputField=row.find('.js-table-input').eq(i);var value=inputField.val().trim();if(!value&&inputField.data('required')){requiredFieldIsEmpty=true;inputField.addClass('hasError');}else if(inputField.attr('type')==='checkbox'){item[col.id]=inputField.prop('checked');}else{item[col.id]=value;inputField.removeClass('hasError');}
if(inputField.attr('type')==='number'&&!requiredFieldIsEmpty){value=parseFloat(value);if((inputField.attr('min')&&value<parseFloat(inputField.attr('min')))||(inputField.attr('max')&&value>parseFloat(inputField.attr('max')))){invalidNumber=true;inputField.addClass('hasError');inputField.trigger('multipleItemsWidget:showNumberError');}else{inputField.removeClass('hasError');inputField.trigger('multipleItemsWidget:hideNumberError');}}});if(requiredFieldIsEmpty){row.trigger('multipleItemsWidget:showRequiredError');}else{row.trigger('multipleItemsWidget:hideRequiredError');}
if(!requiredFieldIsEmpty&&!invalidNumber){if(row.data('hasItem')){data[row.index()]=item;}else{data.push(item);row.data('hasItem',true);}
updateField();updateRow(row,false,false);}}).on('click','.js-add-row',function(e){e.preventDefault();createRow();}).on('click','.js-cancel-edit',function(e){e.preventDefault();var row=$(this).closest('tr');if(!row.data('hasItem')){removeRow(row);}else{updateRow(row,false,false);}}).on('click','.js-edit-row',function(e){e.preventDefault();var row=$(this).closest('tr');updateRow(row,true,false);}).on('keypress','input',function(e){if(e.keyCode===13){e.preventDefault();$(this).closest('tr').find('.js-save-row').trigger('click');}else if(e.keyCode===27){e.preventDefault();$(this).closest('tr').find('.js-cancel-edit').trigger('click');}});function fixWidths(){if(!options.sortable){return;}
widget.find('tbody > tr > td, tbody > tr, tbody').each(function(){$(this).width('');}).each(function(){var $this=$(this);$this.width($this.width());});}
function rowsChanged(moveTooltips){if(options.sortable){widget.find('tbody.ui-sortable').sortable('refresh');}
fixWidths();addButton.prop('disabled',!!widget.find('.js-table-input').length);if(moveTooltips===undefined||moveTooltips){repositionTooltips();}}
function makeColData(item,col,forceEditable){if(item&&!forceEditable){if(col.type==='select'){return{text:options.columnChoices[col.id][item[col.id]]};}else if(col.type==='checkbox'){return{html:$('<span>',{class:'icon-checkbox-{0}'.format(item[col.id]?'checked':'unchecked')}),css:{'text-align':'center'}};}else{return{text:item[col.id]};}}else if(col.type==='select'){var sel=$('<select>',{'class':'js-table-input','data-required':col.required});sel.append($('<option>'));for(var choiceID in options.columnChoices[col.id]){sel.append($('<option>',{value:choiceID,text:options.columnChoices[col.id][choiceID],selected:item?item[col.id]===choiceID:false}));}
return{html:sel};}else if(col.type==='checkbox'){return{html:$('<input>',{type:'checkbox',class:'js-table-input',value:'1',checked:item?item[col.id]:false})};}else if(col.type==='number'){var numberInput=$('<input>',{'type':'number','class':'js-table-input','value':item?item[col.id]:'','placeholder':col.caption,'data-required':col.required,'min':col.min,'max':col.max,'step':col.step?col.step:'any'});initNumberErrorMessage(numberInput,col.min,col.max);return{html:numberInput};}else if(col.type==='textarea'){return{html:$('<textarea>',{'class':'js-table-input multiline','value':item?item[col.id]:'','placeholder':col.caption,'data-required':col.required})};}else{return{html:$('<input>',{'type':'text','class':'js-table-input','value':item?item[col.id]:'','placeholder':col.caption,'data-required':col.required})};}}
function initNumberErrorMessage($element,min,max){$element.qtip({style:{classes:'qtip-danger'},content:{text:function(){if(min&&max){return $T.gettext("Must be between {0} and {1}").format(min,max);}else if(min){return $T.gettext("Must be above {0}").format(min);}else{return $T.gettext("Must be below {0}").format(max);}}},show:{event:'multipleItemsWidget:showNumberError'},hide:{event:'multipleItemsWidget:hideNumberError'}});}
function initRequiredErrorMessage($element){$element.qtip({style:{classes:'qtip-danger'},content:{text:$T("Please fill in the required fields.")},position:{my:'left middle',at:'right middle',adjust:{x:15}},show:{event:'multipleItemsWidget:showRequiredError'},hide:{event:'multipleItemsWidget:hideRequiredError'}});}
function createRow(item){var row=$('<tr>');initRequiredErrorMessage(row);row.data('hasItem',!!item);if(options.uuidField&&item){row.data('uuid',item[options.uuidField]);}
if(options.sortable){$('<td>',{class:'sort-handle'}).appendTo(row);}
options.columns.forEach(function(col){var column=$('<td>',makeColData(item,col));if(col.type==='textarea'){column.addClass('multiline');}
column.appendTo(row);});$('<td>',{html:item?deleteButton.clone().add(editButton.clone()):cancelButton.clone().add(saveButton.clone()),class:'js-action-col'}).appendTo(row);widgetBody.append(row);rowsChanged();}
function updateRow(row,editMode,moveTooltips){row.children('td:not(.sort-handle):not(.js-action-col)').each(function(i){var column=$('<td>',makeColData(data[row.index()],options.columns[i],editMode));if(options.columns[i].type==='textarea'){column.addClass('multiline');}
$(this).replaceWith(column);});if(editMode){row.children('.js-action-col').html(cancelButton.clone().add(saveButton.clone()));}else{row.children('.js-action-col').html(deleteButton.clone().add(editButton.clone()));}
rowsChanged(moveTooltips);}
function removeRow(row){if(row.data('hasItem')){data.splice(row.index(),1);updateField();}
row.remove();rowsChanged(false);}
function updateField(){field.val(JSON.stringify(data)).trigger('change');}};})(window);(function(global){'use strict';global.setupOccurrencesWidget=function setupOccurrencesWidget(options){options=$.extend(true,{fieldId:null,defaultTime:null,defaultDuration:null},options);var rowTemplate=$($.parseHTML($('#'+options.fieldId+'-template').html())).filter('.occurrence');var container=$('#'+options.fieldId+'-container');var dataField=$('#'+options.fieldId+'');function createRow(data){var row=rowTemplate.clone().insertBefore(container.find('.add-occurrence'));var prevRow=row.prev('.occurrence');if(!prevRow.length){prevRow=null;}
var prevOccurrence=prevRow&&prevRow.data('occurrence')||null;var dateField=row.find('.datepicker');var timeField=row.find('.timepicker');var durationField=row.find('.durationpicker');row.find('.remove-occurrence').on('click',function(){removeRow(row);});dateField.datepicker({onSelect:function(){var $this=$(this);$this.trigger('change');if(timeField.val()===''){timeField.val(options.defaultTime);}
$this.blur();updateData();}}).on('change',function(evt){timeField.prop('required',!!evt.target.value);}).on('keydown',function(evt){if(evt.which==K.BACKSPACE){evt.preventDefault();dateField.datepicker('setDate',null);updateData();}else if(evt.which==K.TAB){if(!evt.shiftKey){evt.preventDefault();$(this).nextAll('.timepicker').focus();}}});timeField.on('change',function(evt){dateField.prop('required',!!evt.target.value);updateData();});durationField.on('change',function(){updateData();});if(data){dateField.datepicker('setDate',moment(data.date).format('DD/MM/YYYY'));row.find('.timepicker').val(data.time);row.find('.durationpicker').val(data.duration);dateField.prop('required',true);timeField.prop('required',true);}else if(prevOccurrence){dateField.datepicker('setDate',moment(prevOccurrence.date).add(1,'day').format('DD/MM/YYYY'));row.find('.timepicker').val(prevOccurrence.time);row.find('.durationpicker').val(prevOccurrence.duration);dateField.prop('required',true);timeField.prop('required',true);}else{row.find('.durationpicker').val(options.defaultDuration);}
updateRemoveButtons();updateData();}
function createInitialRows(){JSON.parse(dataField.val()).forEach(function(data){createRow(data);});}
function removeRow(row){row.remove();updateRemoveButtons();updateData();}
function updateRemoveButtons(){var rows=container.find('.occurrence');rows.find('.remove-occurrence').toggle(rows.length>1);}
function updateData(){var data=container.find('.occurrence').map(function(){var $this=$(this);var date=moment($(this).find('.datepicker').datepicker('getDate'));var rv={date:date.isValid()?date.format('YYYY-MM-DD'):'',time:$(this).find('.timepicker').val(),duration:+$(this).find('.durationpicker').val()};$this.data('occurrence',(!!rv.date&&!!rv.time&&!!rv.duration)?rv:null);return rv;}).get();dataField.val(JSON.stringify(data)).trigger('change');}
container.find('.add-occurrence').on('click',function(evt){evt.preventDefault();createRow();});createInitialRows();};})(window);(function(global){'use strict';global.setupOverrideMultipleItemsWidget=function setupOverrideMultipleItemsWidget(options){options=$.extend(true,{fieldId:null},options);var widget=$('#'+options.fieldId+'-widget');var field=$('#'+options.fieldId);var data=JSON.parse(field.val());widget.on('input change','input',function(){var $this=$(this);if(data[$this.data('key')]===undefined){data[$this.data('key')]={};}
data[$this.data('key')][$this.data('field')]=$this.val();updateField();});widget.find('input').each(function(){var $this=$(this);var rowData=data[$this.data('key')]||{};$this.val(rowData[$this.data('field')]||'');});function updateField(){field.val(JSON.stringify(data));}};})(window);(function(global){'use strict';global.setupPersonLinkWidget=function setupPersonLinkWidget(options){options=$.extend(true,{fieldId:null,eventId:null,authorTypes:null,showEmptyCoauthors:true,sort:true,allow:{authors:false,submitters:false,emptyEmail:false,externalUsers:true,speakers:true},defaults:{authorType:0,isSpeaker:false,isSubmitter:false},require:{primaryAuthor:false,secondaryAuthor:false,submitter:false,speaker:false}},options);var $field=$('#'+options.fieldId);var $fieldDisplay=$('#people-list-'+options.fieldId);var $authorList=$fieldDisplay.find('#author-list-'+options.fieldId);var $noAuthorPlaceholder=$fieldDisplay.find('#no-author-placeholder-'+options.fieldId);var $coauthorList=$fieldDisplay.find('#coauthor-list-'+options.fieldId);var $coauthorListTitle=$fieldDisplay.find('#coauthor-list-title-'+options.fieldId);var $noCoauthorPlaceholder=$fieldDisplay.find('#no-coauthor-placeholder-'+options.fieldId);var $otherList=$fieldDisplay.find('#other-list-'+options.fieldId);var $otherListTitle=$fieldDisplay.find('#other-list-title-'+options.fieldId);var $noOtherPlaceholder=$fieldDisplay.find('#no-other-placeholder-'+options.fieldId);var $buttonAddExisting=$('#add-existing-'+options.fieldId);var $buttonAddNew=$('#add-new-'+options.fieldId);var $buttonAlphaOrder=$fieldDisplay.find('.alpha-order-switch');var $form=$field.closest('form');var customOrder=!$buttonAlphaOrder.hasClass('active');var maxNewPersonID=0;function setNewPersonID(person){person.id='new-'+maxNewPersonID;maxNewPersonID++;}
function updatePersonOrder(){var people=_.map($fieldDisplay.find('.person-row'),function(e){return $(e).data('person');});people.forEach(function(person,i){person.displayOrder=customOrder?(i+1):0;$field.principalfield('set',person.id,{displayOrder:person.displayOrder});});}
function setupList(entryType,$list,sortedPeople){var isSortable=options.sort===true;$list.empty();if(isSortable){$list.sortable({axis:'y',containment:'parent',cursor:'move',distance:10,handle:'.sort-handle',items:'> .person-row',tolerance:'pointer',forceHelperSize:true,forcePlaceholderSize:true,helper:function(e,item){var originals=item.children();var helper=item.clone();helper.children().each(function(i){$(this).width(originals.eq(i).width());});return helper;},update:updatePersonOrder});}
sortedPeople.forEach(function(person){renderPerson(person,$list,entryType,isSortable&&customOrder);});}
function renderPeople(people){$coauthorList.empty();$otherList.empty();var sortedPeople=_.clone(people);sortedPeople.sort(function(person1,person2){var k1=person1.displayOrder+' '+person1.name;var k2=person2.displayOrder+' '+person2.name;return strnatcmp(k1,k2);});people.forEach(function(person){setPersonDefaults(person);});if(options.authorTypes){var sortedAuthors=_.filter(sortedPeople,function(person){return person.authorType===options.authorTypes.primary;});var sortedCoAuthors=_.filter(sortedPeople,function(person){return person.authorType===options.authorTypes.secondary;});var sortedOthers=_.filter(sortedPeople,function(person){return(!options.authorTypes||person.authorType===options.authorTypes.none||(!options.allow.authors&&person.isSpeaker));});setupList(options.authorTypes.primary,$authorList,sortedAuthors);setupList(options.authorTypes.secondary,$coauthorList,sortedCoAuthors);setupList(options.authorTypes.none,$otherList,sortedOthers);}else{setupList(null,$otherList,sortedPeople);}
$noAuthorPlaceholder.toggle($authorList.is(':empty'));if(!options.showEmptyCoauthors){$coauthorListTitle.toggle($coauthorList.is(':not(:empty)'));}else{$noCoauthorPlaceholder.toggle($coauthorList.is(':empty'));}
$otherListTitle.toggle($otherList.is(':not(:empty)'));$noOtherPlaceholder.toggle($otherList.is(':empty'));}
function renderPerson(person,$list,entryType,isSortable){var $speakerLabel=$('<span>').addClass('i-label small speaker').text($T.gettext("Speaker"));var $personRow=$('<div>').addClass('person-row').data('person',person);var $personName=$('<div>').addClass('name').text(person.name);var $personRoles=$('<span>').addClass('person-roles');var $personButtons=$('<span>').addClass('person-buttons');var $buttonRemove=$('<a>').addClass('i-link danger icon-close').attr('title',$T.gettext("Remove person"));var $buttonEdit=$('<a>').addClass('i-link icon-edit').attr('title',$T.gettext("Edit information"));var $buttonConfig=$('<a>').addClass('i-link icon-settings').attr('title',$T.gettext("Configure roles"));$personRow.append($personName).append($personRoles).append($personButtons);$personButtons.append($buttonRemove).append($buttonEdit);if(isSortable){$personRow.prepend('<span class="sort-handle">');}
if(options.allow.submitters){var $submitterLabel=$('<span>').addClass('i-label small submitter').text($T.gettext("Submitter"));$personRoles.append($submitterLabel.toggleClass('selected',person.isSubmitter));}
if(options.allow.authors&&options.allow.speakers){$personRoles.prepend($speakerLabel.toggleClass('selected',person.isSpeaker));}
if(entryType!==null&&entryType===options.authorTypes.none){if(options.allow.authors&&options.allow.speakers){$speakerLabel.addClass('other');}}
$list.append($personRow);if(options.allow.submitters||options.allow.authors){$personButtons.append($buttonConfig);setupPersonConfig(person,$buttonConfig,$personRow,$personRoles);}
$buttonEdit.on('click',function(){$field.principalfield('edit',person.id);});$buttonRemove.on('click',function(){$field.principalfield('removeOne',person.id);});}
function setPersonDefaults(person){if(person.authorType===undefined){person.authorType=options.defaults.authorType;}
if(person.isSpeaker===undefined){person.isSpeaker=options.defaults.isSpeaker;}
if(person.isSubmitter===undefined){person.isSubmitter=options.defaults.isSubmitter;}
if(person.id===undefined){setNewPersonID(person);}}
function setupPersonConfig(person,$element,$personRow,$personRoles){var $buttons=$('<div>');var $buttonsSeparator=$('<div>').addClass('titled-rule').text($T.gettext("or"));var $submitterLabel=$personRoles.find('.submitter');var $speakerLabel=$personRoles.find('.speaker');function actionButton(moveText,$targetList,targetData){var $button=$('<div>').addClass('action-row').text(moveText);return $button.on('click',function(){$element.qbubble('hide');if($targetList){$personRow.appendTo($targetList);updatePersonOrder();}
$field.principalfield('set',person.id,targetData);});}
if(options.allow.authors){if(person.authorType!==options.authorTypes.primary){$buttons.append(actionButton($T.gettext("Move to authors"),$authorList,{authorType:1}));}
if(person.authorType!==options.authorTypes.secondary){$buttons.append(actionButton($T.gettext("Move to co-authors"),$coauthorList,{authorType:2}));}
if(options.allow.speakers){if(person.authorType!==options.authorTypes.none){$buttons.append(actionButton($T.gettext("Move to others"),$otherList,{authorType:0,isSpeaker:true}));var text=person.isSpeaker?$T.gettext("Not a speaker anymore"):$T.gettext("Make a speaker");$buttons.append($buttonsSeparator);$buttons.append(actionButton(text,null,{isSpeaker:!person.isSpeaker}));$speakerLabel.on('click',function(){$field.principalfield('set',person.id,{isSpeaker:!person.isSpeaker});});}else{$speakerLabel.qtip({content:{text:$T.gettext("People in the 'Others' section <strong>must</strong> be speakers.")},show:{event:'click',solo:true},hide:{event:'unfocus click'}});}}}
if(options.allow.submitters){var $submitterButton=$('<div>').addClass('action-row');$submitterButton.text(person.isSubmitter?$T.gettext("Revoke submission rights"):$T.gettext("Grant submission rights"));$submitterButton.on('click',function(){$element.qbubble('hide');$field.principalfield('set',person.id,{isSubmitter:!person.isSubmitter});});$buttons.append($submitterButton);$submitterLabel.on('click',function(){$field.principalfield('set',person.id,{isSubmitter:!person.isSubmitter});});}
$element.qbubble({style:{classes:'person-link-qbubble'},content:{text:$buttons},position:{my:'left middle',at:'right middle',adjust:{x:15}},events:{show:function(){$element.addClass('active');$element.closest('.person-row').addClass('active');},hide:function(){$element.removeClass('active');$element.closest('.person-row').removeClass('active');}}});}
$field.principalfield({eventId:options.eventId,allowExternalUsers:options.allow.externalUsers,allowEmptyEmail:options.allow.emptyEmail,multiChoice:true,overwriteChoice:false,render:renderPeople,onAdd:function(people){people.forEach(function(person){if(person.authorType===undefined){var maxOrder=_.max(people,_.iteratee('displayOrder')).displayOrder||0;setPersonDefaults(person);person.displayOrder=customOrder?(maxOrder+1):0;}});}});$buttonAddExisting.on('click',function(){$field.principalfield('choose');});$buttonAddNew.on('click',function(){$field.principalfield('enter');});function getSortingMessage(){if(customOrder){return $T.gettext('Custom sorting has been applied. Click to restore alphabetical order.');}else{return $T.gettext('Alphabetical sorting is ON. Click to turn it off.');}}
$buttonAlphaOrder.qtip({content:getSortingMessage});$buttonAlphaOrder.on('click',function(){var $list=$fieldDisplay.find('.person-list');customOrder=!customOrder;$buttonAlphaOrder.toggleClass('active',!customOrder);if(customOrder){updatePersonOrder();}else{$list.find('.person-row').each(function(){$(this).data('person').displayOrder=0;});}
$field.principalfield('refresh');});$form.on('submit',function(evt){var e=$.Event('ajaxForm:validateBeforeSubmit');$(this).trigger(e);if(e.isDefaultPrevented()){evt.preventDefault();}});$field.closest('form').on('ajaxForm:validateBeforeSubmit',function(evt){var $this=$(this);var req=options.require;if(req.primaryAuthor||req.secondaryAuthor||req.submitter||req.speaker||!options.allow.speakers){var $formField=$field.closest('.form-field');var $formGroup=$field.closest('.form-group');var hiddenData=JSON.parse($field.val());var hasError=false;if(req.speaker&&_.indexOf(_.pluck(hiddenData,'isSpeaker'),true)===-1){hasError=true;$formField.data('error',$T.gettext('You must add at least one speaker'));}else if(req.submitter&&_.indexOf(_.pluck(hiddenData,'isSubmitter'),true)===-1){hasError=true;$formField.data('error',$T.gettext('You must add at least one submitter'));}else if(req.secondaryAuthor&&_.indexOf(_.pluck(hiddenData,'authorType'),2)===-1){hasError=true;$formField.data('error',$T.gettext('You must add at least one co-author'));}else if(req.primaryAuthor&&_.indexOf(_.pluck(hiddenData,'authorType'),1)===-1){hasError=true;$formField.data('error',$T.gettext('You must add at least one author'));}else if(!options.allow.speakers&&_.indexOf(_.pluck(hiddenData,'authorType'),0)!==-1){hasError=true;$formField.data('error',$T.gettext('You cannot have users in the Other section, please make '+'them authors or co-authors'));}
if(hasError){evt.preventDefault();$formGroup.addClass('has-error');showFormErrors($this.parent());}else{$formGroup.removeClass('has-error');$formField.removeData('error');}}});};})(window);(function(global){'use strict';global.setupPrincipalListWidget=function setupPrincipalListWidget(options){options=$.extend(true,{fieldId:null,eventId:null,openImmediately:false,groups:null,allowExternal:false,allowNetworks:false,networks:[]},options);var field=$('#'+options.fieldId);var principals=JSON.parse(field.val());function addPrincipal(newPrincipals,setResult){newPrincipals=_.filter(newPrincipals,function(principal){return!_.findWhere(principals,{identifier:principal.identifier});});principals=_.sortBy(principals.concat(newPrincipals),function(principal){var weight=(principal._type=='Avatar')?0:(principal._type=='Email'?1:(principal.isGroup?2:3));var name=principal._type!=='Email'?principal.name:principal.email;return[weight,name.toLowerCase()];});field.val(JSON.stringify(principals));field.trigger('change');setResult(true,principals);}
function removePrincipal(principal,setResult){principals=_.without(principals,_.findWhere(principals,{identifier:principal.get('identifier')}));field.val(JSON.stringify(principals));field.trigger('change');setResult(true);}
var widget=new UserListField('PluginOptionPeopleListDiv','user-list',principals,true,null,true,options.groups,options.eventId,null,false,false,false,options.eventId!==null,addPrincipal,userListNothing,removePrincipal,options.allowExternal,options.allowNetworks,options.networks);$E('userGroupList-'+options.fieldId).set(widget.draw());if(options.openImmediately){$('#userGroupList-'+options.fieldId+' input[type=button]').trigger('click');}};})(window);(function(global){'use strict';global.setupPrincipalWidget=function setupPrincipalWidget(options){options=$.extend(true,{fieldId:null,eventId:null,required:false,allowExternal:false},options);var field=$('#'+options.fieldId);var button=$('#choose-'+options.fieldId);var display=$('#display-'+options.fieldId);if(!options.required){display.clearableinput({clearOnEscape:false,focusOnClear:false,onClear:function(){field.principalfield('remove');}});}
field.principalfield({eventId:options.eventId,allowExternalUsers:options.allowExternal,enableGroupsTab:false,render:function(users){var name=users[0]?users[0].name:'';if(!options.required){display.clearableinput('setValue',name);}else{display.val(name);}}});display.add(button).on('click',function(){field.principalfield('choose');});};})(window);(function(global){'use strict';global.setupProtectionWidget=function setupProtectionWidget(options){options=$.extend(true,{fieldId:null,fieldName:null,parentProtected:false,aclFieldId:null,aclMessageUrl:null,hasInheritedAcl:false},options);var inputs=$('input[name='+options.fieldName+'][id^='+options.fieldId+']');var $enableAclLink=$('.enable-acl-link');var $aclListField=$('.acl-list-field');inputs.on('change',function(){var $this=$(this);var isProtected=$this.val()==='protected'||($this.val()==='inheriting'&&options.parentProtected);if(this.checked){$('#form-group-protected-{0} .protection-message'.format(options.fieldId)).hide();$('#form-group-protected-{0} .{1}-protection-message'.format(options.fieldId,$this.val())).show();if(options.aclMessageUrl&&options.hasInheritedAcl){$.ajax({url:options.aclMessageUrl,data:{mode:$this.val()},error:handleAjaxError,success:function(data){$this.closest('form').find('.inheriting-acl-message').html(data.html);}});}
$aclListField.toggleClass('hidden',!isProtected);$enableAclLink.toggleClass('hidden',isProtected);}});$enableAclLink.on('click',function(evt){evt.preventDefault();$('input[name='+options.fieldName+'][value="protected"]').trigger('click');});_.defer(function(){inputs.trigger('change');});};})(window);(function(global){'use strict';global.setupSelectizeWidget=function setupSelectizeWidget(options){options=$.extend(true,{fieldId:null,minTriggerLength:0,searchUrl:null,searchMethod:'GET',searchPayload:null,selectizeOptions:null,selectedItem:null,allowById:false,preload:false},options);function getSearchData(query){var m;if(options.allowById&&(m=query.match(/^#(\d+)$/))){return{id:m[1]};}else if(query.length>=options.minTriggerLength){return{q:query};}else if(!query&&options.preload){return{};}else{return null;}}
var $field;var params={load:function(query,callback){var self=this;var data=getSearchData(query);if(!data){return callback();}
if(options.searchPayload){$.extend(data,options.searchPayload);}
$.ajax({url:options.searchUrl,method:options.searchMethod,data:data,cache:false}).fail(function(data){callback();handleAjaxError(data);}).done(function(res){if(!query&&options.preload){self.settings.load=null;}
callback(res);if(options.selectedItem!==null){$field[0].selectize.setValue(options.selectedItem.id);}});},score:function(query){var data=getSearchData(query);if(data&&data.id!==undefined){return function(item){return+(item.friendly_id===+data.id);};}else{var scoreFunc=this.getScoreFunction(query);return function(item){return scoreFunc(item)?1:0;};}}};_.extend(params,options.selectizeOptions);$field=$('#'+options.fieldId);$field.selectize(params);$field[0].selectize.removeOption=function(){return false;};};})(window);(function(global){'use strict';global.setupSyncedInputWidget=function setupSyncedInputWidget(options){options=$.extend(true,{fieldId:null},options);$('#'+options.fieldId+'-action-button').on('click',function(){var field=$('#'+options.fieldId);var syncedValue;field.prop('readonly',this.checked);if(this.checked){syncedValue=JSON.parse(field.attr('data-synced-value'));if(syncedValue!==null){field.val(syncedValue);}}});};})(window);(function(global){'use strict';global.setupTypeaheadWidget=function setupTypeaheadWidget(options){options=$.extend(true,{fieldId:null,minTriggerLength:0,data:null,typeaheadOptions:null,searchUrl:null},options);var field=$('#'+options.fieldId);var params={hint:true,cancelButton:false,mustSelectItem:true,minLength:options.minTriggerLength,source:{data:options.data}};if(options.searchUrl){$.extend(true,params,{dynamic:true,source:{url:[{url:options.searchUrl,data:{q:'{{query}}'}}]}});}
field.typeahead($.extend(true,params,options.typeaheadOptions));};})(window);