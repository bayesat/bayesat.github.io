(function(global){'use strict';function BuildError(message){var argString;if(arguments.length>1){argString=JSON.stringify(Array.prototype.slice.call(arguments,1));argString=argString.substring(1,argString.length-1);}
this.name='BuildError';this.message=message+(argString?': '+argString:'');var err=new Error(this.message);err.name=this.name;return err;}
BuildError.prototype=new Error();BuildError.prototype.constructor=BuildError;var converterFuncs={ListConverter:function(value){if(_.isArray(value)){value=value.join('-');}
return encodeURIComponent(value);}};function splitObj(obj){var names=[];var values=[];for(var name in obj){names.push(name);values.push(obj[name]);}
return{names:names,values:values,original:obj};}
function suitable(rule,args){var defaultArgs=splitObj(rule.defaults||{});var diffArgNames=_.difference(rule.args,defaultArgs.names);var i;for(i=0;i<diffArgNames.length;i++){if(!~_.indexOf(args.names,diffArgNames[i])){return false;}}
if(_.difference(rule.args,args.names).length===0){if(!rule.defaults){return true;}
for(i=0;i<defaultArgs.names.length;i++){var key=defaultArgs.names[i];var value=defaultArgs.values[i];if(value!==args.original[key]){return false;}}}
return true;}
function build(rule,args){var tmp=[];var processed=rule.args.slice();for(var i=0;i<rule.trace.length;i++){var part=rule.trace[i];if(part.is_dynamic){var converter=converterFuncs[rule.converters[part.data]]||encodeURIComponent;var value=converter(args.original[part.data]);if(value===null){return null;}
tmp.push(value);processed.push(part.name);}else{tmp.push(part.data);}}
tmp=tmp.join('');var pipe=tmp.indexOf('|');var url=tmp.substring(pipe+1);var unprocessed=_.difference(args.names,processed);return{url:url,unprocessed:unprocessed};}
function fixParams(params){var cleanParams={};for(var key in params){var value=params[key];if(value===''){continue;}
if(value===undefined||value===null){value=''+value;}
if(!_.isObject(value)||_.isArray(value)){cleanParams[key]=value;}}
return cleanParams;}
function build_url(template,params,fragment){var qsParams,url;params=fixParams(params);if(typeof template==='string'){url=template;qsParams=params||{};}else if(template.type==='flask_rules'){var args=splitObj(params||{});for(var i=0;i<template.rules.length;i++){var rule=template.rules[i];if(suitable(rule,args)){var res=build(rule,args);if(res===null){continue;}
url=res.url;qsParams=_.pick(params,res.unprocessed);break;}}
if(!url){throw new BuildError('Could not build an URL',template.endpoint,params);}
if($('html').data('static-site')){url=url.replace(/^\/event\/\d+/,'');if(url.indexOf('static/')===0){url=url.substring(7);}
url=url.replace(/^\/+/,'').replace(/\/$/,'').replace(/\//g,'--');if(!url.match(/.*\.([^\/]+)$/)){url+='.html';}}else{url=Indico.Urls.BasePath+url;}}else{throw new BuildError('Invalid URL template',template);}
if(!$('html').data('static-site')){var qs=$.param(qsParams);if(qs){url+=(~url.indexOf('?')?'&':'?')+qs;}
if(fragment){url+='#'+fragment.replace(/^#/,'');}}
return url;}
global.BuildError=BuildError;global.build_url=build_url;})(window);(function(global){"use strict";var defaultI18n=new Jed({locale_data:global.TRANSLATIONS,domain:"indico"});global.i18n=defaultI18n;global.$T=_.bind(defaultI18n.gettext,defaultI18n);['gettext','ngettext','pgettext','npgettext','translate'].forEach(function(name){global.$T[name]=_.bind(defaultI18n[name],defaultI18n);});global.$T.domain=_.memoize(function(domain){return new Jed({locale_data:global.TRANSLATIONS,domain:domain});});})(window);(function(global){'use strict';global.confirmPrompt=function confirmPrompt(message,title){var dfd=$.Deferred();message=$('<div>',{width:400,html:message});new ConfirmPopup(title||$T('Please confirm'),message,function(confirmed){if(confirmed){dfd.resolve();}else{dfd.reject();}}).open();return dfd.promise();};global.choiceConfirmPrompt=function choiceConfirmPrompt(message,title,choice1,choice2){var dfd=$.Deferred();message=$('<div>',{width:400,html:message});new SpecialRemovePopup(title||$T('Please confirm'),message,function(action){if(action===0){dfd.reject();}else{dfd.resolve(action);}},choice1,choice2).open();return dfd.promise();};global.alertPopup=function alertPopup(message,title){var dfd=$.Deferred();new AlertPopup(title,message,function(){dfd.resolve();}).open();return dfd;};global.handleFlashes=function handleFlashes(data,clear,element){var container;if(!element||!element.length){container=$('#flashed-messages');}else if(element.hasClass('flashed-messages')){container=element;}else{container=element.closest('.ui-dialog-content').find('.flashed-messages');if(!container.length){container=element.closest('.page-content').find('.flashed-messages');}}
if(!container.length){container=$('#flashed-messages');}
if(clear===undefined||clear){container.empty();}
if(data.flashed_messages){var flashed=$(data.flashed_messages.trim()).children();container.append(flashed);}};global.handleNotifications=function handleNotifications(data){if(data&&data.notifications){_.each(data.notifications,function(notification){cornerMessage({message:notification,duration:10000,class:'highlight',actionLabel:$T.gettext('Close')});});}};global.cornerMessage=function cornerMessage(options){options=$.extend({actionLabel:null,actionCallback:null,message:'',progressMessage:$T.gettext('Executing operation...'),feedbackMessage:$T.gettext('Operation done!'),duration:0,feedbackDuration:4000,class:''},options);var box;function _disappear(when){return setTimeout(function(){box.fadeOut(function(){box.remove();});},when);}
var container=$('#corner-message-container');var disappearHandler=options.duration?_disappear(options.duration):null;if(!container.length){container=$('<div id="corner-message-container">').appendTo('body');}
box=$('<div class="corner-message">').prependTo(container);$('<div class="corner-message-text">').text(options.message).appendTo(box);if(options.class){box.addClass(options.class);}
if(options.actionLabel){var text=$('<a class="corner-message-action" href="#">').text(options.actionLabel).appendTo(box);text.on('click',function(evt){evt.preventDefault();if(disappearHandler){clearTimeout(disappearHandler);}
if(options.actionCallback){var promise=options.actionCallback();box.addClass('progress').find('.corner-message-text').text(options.progressMessage);text.remove();promise.then(function(){box.find('.corner-message-text').text(options.feedbackMessage);box.removeClass(options.class).addClass('success').removeClass('progress');},function(){box.text($T.gettext('Operation failed!'));box.removeClass('progress success warning highlight').addClass('error');}).always(function(){if(options.feedbackDuration){_disappear(options.feedbackDuration);}});}else{_disappear(0);}});}};global.uniqueId=function uniqueId(){return''+Math.round(new Date().getTime()+(Math.random()*100));};global.countWords=function countWords(value){value=value.trim();return value?value.split(/\s+/).length:0;};function _doUpdateHtml(target,html,replace,highlight){var $target=$(target);if(replace){var $html=$($.parseHTML(html,document,true));$target.replaceWith($html);$target=$html;}else{$target.html($.parseHTML(html,document,true));}
$target.trigger('indico:htmlUpdated');if(highlight){$target.effect('highlight',{color:Palette.highlight});}}
global.updateHtml=function updateHtml(target,data,replace,highlight){if($.isPlainObject(target)){for(var key in target){if(!(key in data)){console.error('Invalid key: '+key);}else{_doUpdateHtml(target[key],data[key],replace,highlight);}}}else{_doUpdateHtml(target,data.html,replace,highlight);}};})(window);(function(global){'use strict';function validatePasswordConfirmation(passwordField,confirmField){if('setCustomValidity'in confirmField[0]){passwordField.add(confirmField).on('change input',function(){if(passwordField.val()!==confirmField.val()){confirmField[0].setCustomValidity($T('The passwords do not match.'));}else{confirmField[0].setCustomValidity('');}});}}
function hideFieldUnless(field,conditionField,requiredValues,checkedOnly){conditionField.on('change',function(){var value=checkedOnly?conditionField.filter(':checked').val()||false:conditionField.val();var active=!!((!requiredValues.length&&value)||(requiredValues.length&&_.contains(requiredValues,value)));field.closest('.form-group').toggle(active);var realField=field.is(':input')?field:field.find(':input');if(realField.length){var selectizeField=realField[0].selectize?$('#{0}-selectized'.format(realField[0].id)):$();if(!field.data('initiallyDisabled')){realField.prop('disabled',!active);selectizeField.prop('disabled',!active);}}});}
function validateLength($field){if(!('setCustomValidity'in $field[0])){return;}
var minChars=$field.data('min-length');var maxChars=$field.data('max-length');var minWords=$field.data('min-words');var maxWords=$field.data('max-words');$field.on('change input',function(){var msg='';var charCount=$field.val().trim().length;var wordCount=countWords($field.val());if((minChars&&charCount<minChars)||(maxChars&&charCount>maxChars)){if(!maxChars){msg=$T.ngettext('Field must be at least {0} character long.','Field must be at least {0} characters long.',minChars).format(minChars);}else if(!minChars){msg=$T.ngettext('Field cannot be longer than {0} character.','Field cannot be longer than {0} characters.',maxChars).format(maxChars);}else{msg=$T.gettext('Field must be between {0} and {1} characters long.').format(minChars,maxChars);}}else if((minWords&&wordCount<minWords)||(maxWords&&wordCount>maxWords)){if(!maxWords){msg=$T.ngettext('Field must contain at least {0} word.','Field must contain at least {0} words.',minWords).format(minWords);}else if(!minWords){msg=$T.ngettext('Field cannot contain more than {0} word.','Field cannot contain more than {0} words.',maxWords).format(maxWords);}else{msg=$T.gettext('Field must contain between {0} and {1} words.').format(minWords,maxWords);}}
$field[0].setCustomValidity(msg);});}
function isElementInView(elem){var docViewTop=$(window).scrollTop();var docViewBottom=docViewTop+$(window).height();var elemTop=$(elem).offset().top;var elemBottom=elemTop+$(elem).height();return((elemBottom<=docViewBottom)&&(elemTop>=docViewTop));}
function showSaveCornerMessage($form){cornerMessage({actionLabel:$T.gettext('Save now'),progressMessage:$T.gettext('Saving...'),message:$T.gettext('Do not forget to save your changes!'),class:'highlight save-corner-message',actionCallback:function(){$form.submit();}});}
function hideSaveCornerMessage($cornerMessage){$cornerMessage.fadeOut(300,function(){$cornerMessage.remove();});}
global.initForms=function initForms(forms){forms.find('input[data-confirm-password]').each(function(){var confirmField=$(this);var passwordField=$(this.form).find('input[name="'+confirmField.data('confirmPassword')+'"]');validatePasswordConfirmation(passwordField,confirmField);});forms.find(':input[data-hidden-unless]:disabled').data('initiallyDisabled',true);forms.find(':input[data-hidden-unless]').each(function(){var field=$(this);var data=field.data('hidden-unless');var conditionField=$(this.form).find(':input[name="{0}"]'.format(data.field));hideFieldUnless(field,conditionField,data.values,data.checked_only);conditionField.triggerHandler('change');});var selectors='[data-min-words], [data-max-words], [data-min-length], [data-max-length]';forms.find('input, textarea').filter(selectors).each(function(){validateLength($(this));});forms.find('[data-disabled-until-change]').prop('disabled',true);forms.each(function(){var $this=$(this);if($this.data('initialized')){console.warn('re-initialized form',this);}
$this.data('initialized',true);function _resetData(){$this.data('initialData',$this.serialize());$this.data('fieldsChanged',false);}
_resetData();$this.on('indico:fieldsSaved',function(){_resetData();$this.find('[data-disabled-until-change]').prop('disabled',true);});}).on('change input',function(){var $this=$(this);var untouched=$this.serialize()===$this.data('initialData');var $cornerMessage=$('.save-corner-message');$this.find('[data-disabled-until-change]').prop('disabled',untouched);$this.closest('form').data('fieldsChanged',!untouched);if($this.find('[data-save-reminder]').length&&!$this.data('locked-event-disabled')){if(!isElementInView($this.find('[data-save-reminder]'))&&!untouched&&!$cornerMessage.length){showSaveCornerMessage($this);}else if(untouched){hideSaveCornerMessage($cornerMessage);}}});$(window).off('scroll.initForms').on('scroll.initForms',_.debounce(function(){var $form=forms.find('[data-save-reminder]').closest('form');if($form.length){var $cornerMessage=$('.save-corner-message');var untouched=$form.serialize()===$form.data('initialData');if(isElementInView($form.find('[data-save-reminder]'))){hideSaveCornerMessage($cornerMessage);}else if(!untouched&&!$cornerMessage.length){showSaveCornerMessage($form);}}},100));forms.find('fieldset.collapsible > legend').on('click',function(evt){evt.preventDefault();var $this=$(this);var $collapseIcon=$this.find('div > span');$this.next('.fieldset-content').slideToggle();$collapseIcon.toggleClass('icon-next icon-expand');});forms.find('fieldset.collapsible.initially-collapsed').each(function(){var $this=$(this);if($this.find('div.form-field[data-error]').length){$this.find('legend').trigger('click');}});if(forms.closest('.event-locked').length){var lockedForms=forms.filter('.disable-fields-if-locked');lockedForms.data('locked-event-disabled',true);lockedForms.find(':input:not([type=hidden]):not([data-button-back])').prop('disabled',true);lockedForms.find(':input:submit').hide();}};global.toggleAclField=function toogleAclField(aclField,state){aclField.closest('.form-group').find('input.i-button').prop('disabled',state).end().find('a.i-button').toggleClass('disabled',state).end().find('.PluginOptionPeopleListDiv').toggleClass('disabled',state);};global.aclIfProtected=function aclIfProtected(protectionField,aclField,selfProtection,inheritedProtection,folderField,folderProtection){protectionField.on('change',function(){toggleAclField(aclField,!this.checked);if(selfProtection&&inheritedProtection){selfProtection.toggle(this.checked);inheritedProtection.toggle(!this.checked);if(folderField){folderField.triggerHandler('change');}else{folderProtection.hide();}}});_.defer(function(){protectionField.triggerHandler('change');if(folderField){folderField.triggerHandler('change');}});};global.messageIfFolderProtected=function messageIfFolderProtected(protectionField,folderField,protectionInfo,selfProtection,inheritedProtection,folderProtection){folderField.on('change',function(){var selectedFolder=$(this);if(protectionInfo[selectedFolder.val()]&&!protectionField.prop('checked')){selfProtection.hide();inheritedProtection.hide();folderProtection.find('.folder-name').html(selectedFolder.children('option:selected').text());folderProtection.show();}else{folderProtection.hide();selfProtection.toggle(protectionField.prop('checked'));inheritedProtection.toggle(!protectionField.prop('checked'));}});_.defer(function(){folderField.triggerHandler('change');});};global.enableIfChecked=function enableIfChecked(checkboxContainer,checkboxSelector,buttonSelector,extraCheckCallback){function _update(force){var $checkboxes=$(checkboxContainer).find(checkboxSelector).filter(':checked');var checked=force||!!$checkboxes.length;if(extraCheckCallback&&extraCheckCallback($checkboxes)===false){checked=false;}
$(buttonSelector).prop('disabled',!checked).toggleClass('disabled',!checked);}
$(checkboxContainer).on('change',checkboxSelector,function(){_update(this.checked);}).on('indico:syncEnableIfChecked',function(){_update();});_update();};global.paginatedSelectAll=function paginatedSelectAll(options){options=$.extend(true,{containerSelector:null,checkboxSelector:null,allSelectedSelector:null,selectionMessageSelector:null,totalRows:0,messages:{allSelected:function(total){return $T.ngettext('*','All {0} rows are currently selected.').format(total);},pageSelected:function(selected,total){return $T.ngettext('Only {0} out of {1} rows is currently selected','Only {0} out of {1} rows are currently selected.',selected).format(selected,total);}}},options);var container=$(options.containerSelector);container.on('change',options.checkboxSelector,_update);_update();function _update(){var messageContainer=$(options.selectionMessageSelector).empty();var numChecked=container.find(options.checkboxSelector+':checked').length;var numUnchecked=container.find(options.checkboxSelector+':not(:checked)').length;var numRows=numChecked+numUnchecked;if(numChecked<numRows){messageContainer.hide();_setAllSelected(false);}else if(numChecked===options.totalRows){messageContainer.hide();_setAllSelected(true);}else if(numChecked===numRows){if(_getAllSelected()){$('<span>',{html:options.messages.allSelected(options.totalRows)}).appendTo(messageContainer);messageContainer.append(' ');$('<a>',{href:'#',text:$T.gettext('Select only the current page.'),click:function(evt){evt.preventDefault();_setAllSelected(false);_update();}}).appendTo(messageContainer);}else{$('<span>',{html:options.messages.pageSelected(numChecked,options.totalRows)}).appendTo(messageContainer);messageContainer.append(' ');$('<a>',{href:'#',text:$T.gettext('Click here to select them all.'),click:function(evt){evt.preventDefault();_setAllSelected(true);_update();}}).appendTo(messageContainer);}
messageContainer.show();}}
function _getAllSelected(){return container.find(options.allSelectedSelector).prop('checked');}
function _setAllSelected(selected){container.find(options.allSelectedSelector).prop('checked',selected).trigger('change');}
return{isEverythingSelected:_getAllSelected};};global.getDropzoneFiles=function getDropzoneFiles($form){var files={};var dropzoneField=$form.data('dropzoneField');if(dropzoneField){files[dropzoneField.id]=$form[0].dropzone.getUploadingFiles();}
return files;};var DROPZONE_FILE_KEYS=['upload','status','previewElement','previewTemplate','_removeLink','accepted','width','height','processing','xhr'];global.setDropzoneFiles=function setDropzoneFiles($field,files){var dropzone=$field.closest('form')[0].dropzone;_.defer(function(){files.forEach(function(file){DROPZONE_FILE_KEYS.forEach(function(key){delete file[key];});dropzone.addFile(file);});});};$(document).ready(function(){initForms($('form'));$('body').on('indico:htmlUpdated',function(evt){var $target=$(evt.target);var $forms=$target.find('form');if($forms.length){initForms($forms);showFormErrors($target);}});});})(window);