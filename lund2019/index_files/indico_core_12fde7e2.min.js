extend(Html.prototype,{ancestorOf:function(child){if(!child){return false;}else if(this.dom==child.dom){return true;}else if(child.getParent()===null){return false;}else if(child.getParent()==this){return true;}else if(child.getParent().dom==document.body){return false;}else{return this.ancestorOf(child.getParent());}},replaceWith:function(element){this.getParent().dom.replaceChild(element.dom,this.dom);}});extend(WatchObject.prototype,{clone:function(){return $O(this.getAll());}});function eventTarget(event){return any(event.srcElement,event.target);}
function $N(name){return translate(document.getElementsByName(name),$E);}
function positive(){return true;}
function createObject(clazz,args){function Dummy(){}
Dummy.prototype=clazz.prototype;var x=new Dummy();x.constructor=clazz;clazz.apply(x,args);return x;}
function escapeHTML(html){return html.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
var SortCriteria={Default:function(e1,e2){return e1==e2?0:(e1<e2?-1:1);},Integer:function(e1,e2){if(isNaN(parseInt(e1,10))||isNaN(parseInt(e2,10))){return SortCriteria.Default(e1,e2);}else{return parseInt(e1,10)==parseInt(e2,10)?0:(parseInt(e1,10)<parseInt(e2,10)?-1:1);}}};function partition(list,start,end,index,cmp){var pval=list.item(index);list.swap(index,end);var store=start;for(var i=start;i<end;++i){if(cmp(list.item(i),pval)<0){list.swap(i,store);store++;}}
list.swap(store,end);return store;}
function quicksort(list,start,end,cmp){if(end>start){var pnew=partition(list,start,end,start,cmp);quicksort(list,start,pnew-1,cmp);quicksort(list,pnew+1,end,cmp);}}
extend(WatchList.prototype,{swap:function(source,destination){var itemS=this.item(source);var itemD=this.item(destination);this.replaceAt(source,itemD);this.replaceAt(destination,itemS);},sort:function(compare){compare=compare||SortCriteria.Default;quicksort(this,0,this.length.get()-1,compare);}});Html.unescaped=map({'div':null,'span':null},function(value,elemType){return function(){var res=Html[elemType].apply(this,arguments);res.dom.innerHTML=res.get();return res;};});declareMixin=function(targetName,sourceName,mixins){type(targetName,[sourceName].concat(mixins),{},function(){this[sourceName].apply(this,arguments);});};var IndicoGlobalVars={};var Util={parseId:function(id){var m=id.match(/^(?:([^\.]+)\.)?s(\d+)$/);if(m){return concat(["Session"],m.slice(1));}
m=id.match(/^(?:([^\.]+)\.)s(\d+)(?:\.|l)(\d+)$/);if(m){return concat(["SessionSlot"],m.slice(1));}
m=id.match(/^(?:([^\.]+)\.)(\d+)$/);if(m){return concat(["Contribution"],m.slice(1));}
return concat(["Conference"],[id]);},truncate:function(title,length){length=length||25;if(title.length>length){return title.substring(0,length-3)+"...";}else{return title;}},formatDateTime:function(obj,format,sourceFormat){format=format||"%d/%m/%Y %H:%M";var m1=null,m2=null;if(obj===null){return null;}
else if(obj.constructor==Date){m1=[null,obj.getFullYear(),obj.getMonth()+1,obj.getDate()];m2=[null,zeropad(obj.getHours()),obj.getMinutes(),obj.getSeconds()];}else if(typeof(obj)=='object'){m1=obj.date.match(/(\d+)[\-\/](\d+)[\-\/](\d+)/);m2=obj.time.match(/(\d+):(\d+)(?:\:(\d+))?/);}else if(sourceFormat){var results=Util.__parseDateTime(obj,sourceFormat);m1=[null,results['%Y'],results['%m'],results['%d']];m2=[null,any(results['%H'],''),any(results['%M'],''),any(results['%S'],'')];}else{throw'unknown source object';}
if(!m1||!m2){return null;}
return format.replace('%Y',zeropad(m1[1])).replace('%m',zeropad(m1[2])).replace('%d',zeropad(m1[3])).replace('%H',zeropad(m2[1])).replace('%M',zeropad(m2[2])).replace('%S',zeropad(m2[3]));},__parseDateTime:function(string,format){format=format||"%Y/%m/%d %H:%M";if(!string){return null;}
var tokenOrder=[];var reFormat=format.replace(/%\w/g,function(val){tokenOrder.push(val);return val=='%Y'?'(\\d{0,4})':'(\\d{0,2})';}).replace(' ','\\s+');var m=string.match('^'+reFormat+'$');if(!m){return null;}
var results={'%Y':0,'%m':1,'%d':1,'%H':0,'%M':0,'%S':0};for(var i=1;i<m.length;++i){results[tokenOrder[i-1]]=m[i];}
return results;},parseJSDateTime:function(string,format){var results=Util.__parseDateTime(string,format);if(!results){return null;}
var date=new Date(results['%Y'],results['%m']-1,results['%d']);if(date.getDate()!=results['%d']||(date.getMonth()+1)!=results['%m']){return null}
setTime(date,[results['%H'],results['%M'],results['%S']]);return date;},parseDateTime:function(string,format){var results=Util.__parseDateTime(string,format);if(!results){return null;}
return{date:zeropad(results['%Y'])+'/'+zeropad(results['%m'])+'/'+zeropad(results['%d']),time:zeropad(results['%H'])+':'+zeropad(results['%M'])+':'+zeropad(results['%S'])};},dateTimeIndicoToJS:function(obj){var m1=obj.date.match(/(\d+)[\-\/](\d+)[\-\/](\d+)/);var m2=obj.time.match(/(\d+):(\d+)(?::(\d+))?/);var date=new Date(m1[1],m1[2]-1,m1[3]||0);setTime(date,[m2[1],m2[2],m2[3]]);return date;},HTMLEscape:function(text){return $('<p/>').text(text||'').html();}};Util.Validation={isEmailAddress:function(address){return exists(address.toLowerCase().match(/^[a-z0-9!#$%&\'*+\/=?\^_`{|}~\-]+(?:\.[a-z0-9!#$%&\'*+\/=?\^_`{|}~\-]+)*@(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?$/));},isURL:function(address){return exists(address.match(/^(([^:\/?#]+):)((\/\/)?([^\/?#]+))([^?#]*)(\?([^#]*))?(#(.*))?$/));},isHtml:function(text){return/<.*>[\s\S]*<\/.*>|<br\s*\/>/.exec(text);}};var IndicoDateTimeFormats={International:'%d/%m/%Y %H:%M',ISO8601:'%Y/%m/%d %H:%M',Ordinal:'%Y%m%d'};IndicoDateTimeFormats.Default=IndicoDateTimeFormats.International;IndicoDateTimeFormats.Server=IndicoDateTimeFormats.ISO8601;IndicoDateTimeFormats.DefaultHourless=IndicoDateTimeFormats.Default.split(' ')[0];IndicoDateTimeFormats.ServerHourless=IndicoDateTimeFormats.Server.split(' ')[0];function imageFunctionGenerator(url){return function(imageId,extension){return url+'/'+imageId+'.'+(extension||'png');};}
var indicoSource=curry(jsonRpcValue,Indico.Urls.JsonRpcService);var indicoRequest=curry(jsonRpc,Indico.Urls.JsonRpcService);var imageSrc=imageFunctionGenerator(Indico.Urls.ImagesBase);function pixels(val){return val+'px';}
function zeropad(number){return((''+number).length==1)?'0'+number:number;}
var IndicoUI={__globalLayerLevel:0,__globalLayerLevels:[true],assignLayerLevel:function(element){if(!exists(element))
return;for(var i=this.__globalLayerLevel;i>=0;i--){if(this.__globalLayerLevels[i]){this.__globalLayerLevel=i;break;}}
var level=++this.__globalLayerLevel;this.__globalLayerLevels[level]=true;element.setStyle('zIndex',this.__globalLayerLevel+3000);},unAssignLayerLevel:function(element){if(!exists(element))
return;var level=element.dom.style.zIndex;if(level==''){return;}
this.__globalLayerLevels[parseInt(level)-3000]=false;}};_.mixin({move:function(array,fromIndex,toIndex){array.splice(toIndex,0,array.splice(fromIndex,1)[0]);return array;}});function strcmp(str1,str2){return((str1==str2)?0:((str1>str2)?1:-1));}
function strnatcmp(f_string1,f_string2,f_version){var i=0;if(f_version==undefined){f_version=false;}
var __strnatcmp_split=function(f_string){var result=[];var buffer='';var chr='';var i=0,f_stringl=0;var text=true;f_stringl=f_string.length;for(i=0;i<f_stringl;i++){chr=f_string.substring(i,i+1);if(chr.match(/\d/)){if(text){if(buffer.length>0){result[result.length]=buffer;buffer='';}
text=false;}
buffer+=chr;}else if((text==false)&&(chr=='.')&&(i<(f_string.length-1))&&(f_string.substring(i+1,i+2).match(/\d/))){result[result.length]=buffer;buffer='';}else{if(text==false){if(buffer.length>0){result[result.length]=parseInt(buffer,10);buffer='';}
text=true;}
buffer+=chr;}}
if(buffer.length>0){if(text){result[result.length]=buffer;}else{result[result.length]=parseInt(buffer,10);}}
return result;};var array1=__strnatcmp_split(f_string1+'');var array2=__strnatcmp_split(f_string2+'');var len=array1.length;var text=true;var result=-1;var r=0;if(len>array2.length){len=array2.length;result=1;}
for(i=0;i<len;i++){if(isNaN(array1[i])){if(isNaN(array2[i])){text=true;if((r=this.strcmp(array1[i],array2[i]))!=0){return r;}}else if(text){return 1;}else{return-1;}}else if(isNaN(array2[i])){if(text){return-1;}else{return 1;}}else{if(text||f_version){if((r=(array1[i]-array2[i]))!=0){return r;}}else{if((r=this.strcmp(array1[i].toString(),array2[i].toString()))!=0){return r;}}
text=false;}}
return result;}
IndicoUI.Buttons={removeButton:function(faded,fadedCaption){var caption=faded?(exists(fadedCaption)?fadedCaption:'Remove (blocked)'):'Remove';return Html.img({alt:caption,title:caption,src:faded?imageSrc("remove_faded"):imageSrc("remove"),style:{'marginLeft':'5px','verticalAlign':'middle'}});},editButton:function(faded,fadedCaption){var caption=faded?(exists(fadedCaption)?fadedCaption:'Edit (blocked)'):'Edit';return Html.img({alt:caption,title:caption,src:faded?imageSrc("edit_faded"):imageSrc("edit"),style:{'marginLeft':'5px','verticalAlign':'middle'}});}};IndicoUI.Effect={appear:function(element,newStyle){if(!exists(newStyle)){newStyle='';}
element.dom.style.display=newStyle;},disappear:function(element){element.dom.style.display='none';},followScroll:function(){$.each($('.follow-scroll'),function(){if(!$(this).data('original-offset')){$(this).data('original-offset',$(this).offset());}
var eloffset=$(this).data('original-offset');var windowpos=$(window).scrollTop();if(windowpos>eloffset.top){if(!$(this).hasClass("scrolling")){$(this).data({"original-left":$(this).css("left"),"original-width":$(this).css("width")});$(this).css("width",$(this).width());$(this).css("left",eloffset.left);$(this).addClass('scrolling');}}else{if($(this).hasClass("scrolling")){$(this).css("left",$(this).data("original-left"));$(this).css("width",$(this).data("original-width"));$(this).removeClass('scrolling');}}});}};function mouseOverSwitch(observable,overAction,outAction){observable.observeEvent('mouseover',function(event){overAction(event);});observable.observeEvent('mouseout',function(event){outAction(event);});}
function highlightWithMouse(observable,target){if(target.__highlightSet){return observable;}
mouseOverSwitch(observable,function(){target.__tmpColor=target.dom.style.backgroundColor;if(target.__tmpColor===''){return;}
var bgColor=target.dom.style.backgroundColor;var s=bgColor.match(/rgb\((\d+), (\d+), (\d+)\)/);if(!s){s=bgColor.match(/#(..)(..)(..)/);if(!s){return;}
s[1]=parseInt('0x'+s[1],16);s[2]=parseInt('0x'+s[2],16);s[3]=parseInt('0x'+s[3],16);}
s[1]=Math.floor(s[1]*1.05);s[2]=Math.floor(s[2]*1.05);s[3]=Math.floor(s[3]*1.05);target.setStyle('backgroundColor','rgb('+s[1]+','+s[2]+','+s[3]+')');},function(){target.setStyle('backgroundColor',target.__tmpColor);});target.__highlightSet=true;return observable;}
type('Printable',[],{print:function(element,title){var body=$E(document.body);var bodyCSSClasses=body.dom.className;var elementCSSClasses=element.dom.className;element.dom.className=elementCSSClasses+" print";body.dom.className=bodyCSSClasses+=" noprint";window.print();}});var addedWebkitJqueryFixDiv=false;type("IWidget",[],{draw:function(content){return content;},postDraw:function(){},_drawHeader:function(){return'';},disable:function(){},enable:function(){},show:function(){},hide:function(){}});type("EnumWidget",["WatchObject","IWidget"],{getId:function(){return this.id;},clearList:function(){var self=this;self.message=null;self.clear();self.domList.clear();},_getHeader:function(){return null;},setMessage:function(message){this.clearList();this.message=message;this.domList.append(Html.li('listMessage',message));},draw:function(){var self=this;var returnedDom=$B(self.domList,self,function(pair){var listItem=self._iteratingElement({id:self.id+'_'+pair.key,pair:pair},self._drawItem(pair));if(exists(self.mouseoverObserver)){listItem.observeEvent('mouseover',function(event){self.mouseoverObserver(true,pair,listItem,event);});listItem.observeEvent('mouseout',function(event){self.mouseoverObserver(false,pair,listItem,event);});}
self._postDraw(pair);return listItem;});var header=self._getHeader();if(header){self.domList.insert(header);}
if(exists(this.message)){this.domList.append(self._iteratingElement('listMessage',this.message));}
return this.IWidget.prototype.draw.call(this,returnedDom);},_postDraw:function(pair){return'';},_drawItem:function(pair){return'';}},function(listCssClass,mouseoverObserver){this.WatchObject();this.id=Html.generateId();this.domList=this._containerElement({id:this.id,className:listCssClass});this.listCssClass=listCssClass;this.mouseoverObserver=mouseoverObserver;});type("ListWidgetMixin",[],{_iteratingElement:function(){return Html.li.apply(this,arguments);},_containerElement:function(){return Html.ul.apply(this,arguments);}});declareMixin("ListWidget","EnumWidget",["ListWidgetMixin"]);type("SelectableListWidget",["ListWidget"],{getSelectedList:function(){return this.selectedList;},clearSelection:function(){var self=this;each(self.domList,function(listItem){if(listItem.dom.className.search(self.selectedCssClass)>=0){listItem.dom.className=listItem.dom.className.replace(self.selectedCssClass,self.unselectedCssClass);}});this.selectedList.clear();},selectAll:function(){var self=this;each(self.domList,function(listItem){listItem.dom.className=self.selectedCssClass;});each(self,function(value,key){self.selectedList.set(key,value);});if(exists(self.selectedObserver)){self.selectedObserver(self.selectedList);}},clearList:function(){this.clearSelection();this.ListWidget.prototype.clearList.call(this);},setMessage:function(message){this.clearSelection();this.ListWidget.prototype.setMessage.call(this,message);},selectItem:function(listItem,pair){var self=this;if(exists(self.selectedList.get(pair.key))){self.selectedList.set(pair.key,null);listItem.dom.className=self.unselectedCssClass;}else{if(self.onlyOne){self.clearSelection();}
self.selectedList.set(pair.key,pair.get());listItem.dom.className=self.selectedCssClass;}
if(exists(self.selectedObserver)){self.selectedObserver(self.selectedList);}},getReturnedDOM:function(self){var dom=$B(self.domList,self,function(pair){var listItem=Html.li({id:self.id+'_'+pair.key},self._drawItem(pair));if(pair.get().get("unselectable")===true){listItem.dom.className+=' unselectable';}else{listItem.observeClick(function(event){self.selectItem(listItem,pair)});}
if(exists(self.mouseoverObserver)){listItem.observeEvent('mouseover',function(event){self.mouseoverObserver(true,pair,listItem,event);});listItem.observeEvent('mouseout',function(event){self.mouseoverObserver(false,pair,listItem,event);});}
return listItem;});if(exists(this.message)){this.domList.append(Html.li('listMessage',this.message));}
return dom;},draw:function(){var self=this;var returnedDom=self.getReturnedDOM(self);return this.IWidget.prototype.draw.call(this,returnedDom);},_drawItem:function(pair){return'';}},function(selectedObserver,onlyOne,listCssClass,selectedCssClass,unselectedCssClass,mouseoverObserver){this.selectedList=$O();this.selectedObserver=selectedObserver;this.onlyOne=any(onlyOne,false);if(exists(selectedCssClass)){this.selectedCssClass=selectedCssClass;}else{this.selectedCssClass="selectedListItem";}
if(exists(unselectedCssClass)){this.unselectedCssClass=unselectedCssClass;}else{this.unselectedCssClass="unselectedListItem";}
this.ListWidget(listCssClass,mouseoverObserver);});type("JTabWidget",["IWidget"],{_addTab:function(label,content,data){var id=_.uniqueId('x-tab-');$(content).css('display','').find('script').remove();var container=$('<div/>',{id:id}).data(data||{}).html(content);var navLink=$('<a>',{href:'#'+id,text:this._titleTemplate(label)});this.widget.append(container);this.widget.find('.ui-tabs-nav').append($('<li>').append(navLink));this.widget.tabs('refresh');if(this.widget.tabs('option','active')===false){this.widget.tabs('option','active',0);}},_titleTemplate:function(text){return text;},draw:function(){var self=this;_.defer(function(){self._updateScrollButtons();$.each(self._onDraw,function(i,func){func();});self._onDraw=[];});return self.widget[0];},enable:function(){this.widget.tabs('enable');for(var i=0,num=this.widget.data('ui-tabs').anchors.length;i<num;i++){this.enableTab(i);}
if(this.scrollable){this._updateScrollButtons();}},disable:function(){this.widget.tabs('disable');for(var i=0,num=this.widget.data('ui-tabs').anchors.length;i<num;i++){this.disableTab(i);}
if(this.scrollable){this.scrollButtons.children().addClass('ui-state-disabled');}},enableTab:function(index){this.widget.tabs('enable',index);},disableTab:function(index){this.widget.tabs('disable',index);},getLabel:function(index){return $('.ui-tabs-nav > li',this.widget).eq(index);},getTabIndex:function(label){var self=this;return $('.ui-tabs-nav > li',self.widget).filter(function(){return $(this).text()==self._titleTemplate(label);}).eq(0).index();},getSelectedIndex:function(){return this.widget.tabs('option','active');},getSelectedTab:function(){return this.getLabel(this.getSelectedIndex());},setSelectedTab:function(labelOrIndex){var idx=_.isNumber(labelOrIndex)?labelOrIndex:this.getTabIndex(labelOrIndex);this.widget.tabs('option','active',idx);this.scrollToTab(idx,true);},getSelectedPanel:function(){var index=this.widget.tabs('option','active');return $('> div.ui-tabs-panel',this.widget).eq(index);},heightToTallestTab:function(){var maxHeight=0;var panel=$('> div.ui-tabs-panel',this.widget);panel.each(function(){maxHeight=Math.max(maxHeight,$(this).height());});_.defer(function(){panel.height(maxHeight);});},makeScrollable:function(){var self=this;if(self.scrollable){return;}
self.scrollable=true;var nav=$('> .ui-tabs-nav',self.widget);nav.css('padding',0);nav.wrap($('<div/>').css({whiteSpace:'nowrap',overflow:'hidden'}));nav.find('> li').css({'display':'block','float':'left'});nav.css({marginLeft:'17px',marginRight:'15px'});var arrowsTopMargin='4px';var arrowsCommonCss={cursor:'pointer',zIndex:99,position:'absolute',top:'1px',height:'26px'};self.scrollOffset=0;self.scrollButtons=$('<div/>').disableSelection().css({position:'relative',zIndex:100});$('<span/>').disableSelection().attr('title',$T('Previous tab')).css(arrowsCommonCss).css('left',0).addClass('ui-state-active ui-corner-tl ui-corner-bl').append($('<span/>').disableSelection().addClass('ui-icon ui-icon-carat-1-w').html($T('Previous tab')).css('marginTop',arrowsTopMargin)).click(function(){if($(this).hasClass('ui-state-disabled')){return;}
self.scrollToTab(Math.max(0,self.scrollOffset-1));}).appendTo(self.scrollButtons);$('<span/>').disableSelection().attr('title',$T('Next tab')).css(arrowsCommonCss).css('right',0).addClass('ui-state-active ui-corner-tr ui-corner-br').append($('<span/>').addClass('ui-icon ui-icon-carat-1-e').html($T('Next tab')).css('marginTop',arrowsTopMargin)).click(function(){if($(this).hasClass('ui-state-disabled')){return;}
self.scrollToTab(Math.min(nav.find('> li').length-1,self.scrollOffset+1));}).appendTo(self.scrollButtons);self.scrollButtons.prependTo(self.widget);self.scrollToTab(self.getSelectedIndex(),true);},_updateScrollButtons:function(){if(!this.scrollable){return;}
var nav=$('.ui-tabs-nav:first',this.widget);var visibleTabs=0;var width=0;var navWidth=nav.width();nav.find('> li:visible').each(function(){width+=$(this).outerWidth(true);if(width>=navWidth){return false;}
visibleTabs++;});var lastElementShown=false;if(this.scrollOffset+visibleTabs==nav.find('> li').length){lastElementShown=true;}
this.scrollButtons.children().eq(0).toggleClass('ui-state-disabled',this.scrollOffset==0);this.scrollButtons.children().eq(1).toggleClass('ui-state-disabled',lastElementShown);},scrollToTab:function(idx,fuzzy){var self=this;if(!self.scrollable){return;}
if(fuzzy&&!$('.ui-tabs-nav:first',self.widget).width()){self._onDraw.push(function(){self.scrollToTab(idx,fuzzy);});return;}
else if(fuzzy&&idx>0){var nav=$('.ui-tabs-nav:first',self.widget);if(!$.browser.msie){var origIdx=idx;while(idx>=0){self.scrollToTab(idx-1);if(nav.find(' > li').eq(origIdx).is(':hidden')){self.scrollToTab(idx);return;}
idx--;}
self.scrollToTab(origIdx);return;}
else{var allTabs=nav.find('> li');var totalWidth=0;$.each(allTabs,function(){totalWidth+=$(this).outerWidth(true);});var avgTabWidth=Math.ceil(totalWidth/allTabs.length);var avgVisibleTabs=Math.floor(nav.width()/avgTabWidth);if(idx+avgVisibleTabs>=allTabs.length){idx=allTabs.length-avgVisibleTabs+1;}}}
self.scrollOffset=idx;$('.ui-tabs-nav:first > li',self.widget).show().slice(0,self.scrollOffset).hide();var nav=$('.ui-tabs-nav:first',self.widget);var visibleTabs=0;var width=0;var updateTabsAfter=function(){var navWidth=nav.width();nav.find('> li:visible').each(function(){width+=$(this).outerWidth(true);if(width>=navWidth){return false;}
visibleTabs++;});$('.ui-tabs-nav:first > li',self.widget).slice(self.scrollOffset+visibleTabs).hide();};if(nav.width()){updateTabsAfter();}
else{self._onDraw.push(updateTabsAfter);}
self._updateScrollButtons();},_drawExtraButtons:function(){var container=$('<div class="tabExtraButtons"/>');$.each(this.extraButtons,function(i,btnData){var btn=$('<div class="buttonContainer"/>').append(btnData.btn.dom||btnData.btn).click(function(){btnData.onclick(btn);});container.append(btn);});container.children(':first').addClass('buttonContainerLeft');container.children(':last').addClass('buttonContainerRight');this.widget.append(container);},_notifyTabChange:function(){}},function(tabs,width,height,initialSelection,extraButtons,canvas){var self=this;self.scrollable=false;self._onDraw=[];self.widget=$('<div><ul/></div>');self.extraButtons=extraButtons||[];if(canvas){self.canvas=$(canvas.dom||canvas);}
else{self.canvas=$('<div/>');}
self.width=exists(width)?((typeof(width)=='string'&&width.indexOf('%')>=0)?width:pixels(width)):width;if(self.width){self.widget.width(self.width);}
if(height){self.widget.css('minHeight',height);}
if(self.extraButtons){self._drawExtraButtons();}
self.widget.tabs({beforeActivate:function(e,ui){self._notifyTabChange();}});$.each(tabs,function(i,tab){var content=tab[1].dom?tab[1].dom:tab[1];self._addTab(tab[0],content);});if(initialSelection){self.setSelectedTab(initialSelection);}});type("JLookupTabWidget",["JTabWidget"],{_addTab:function(label,generator){var content='<div/>';this.JTabWidget.prototype._addTab.call(this,label,content,{generator:generator});},_generateContent:function(panel){var container=$('> div',panel);var generator=$(panel).data('generator');try{var content=generator();}catch(e){if(e=='stopDrawing'){return;}
throw e;}
if(content.dom){content=content.dom;}
this.canvas.empty().append(content);container.empty().append(this.canvas);}},function(tabs,width,height,initialSelection,extraButtons,canvas){var self=this;self.JTabWidget(tabs,width,height,initialSelection,extraButtons,canvas);self.widget.bind('tabsactivate',function(e,ui){self._generateContent(ui.newPanel);});self._generateContent(self.getSelectedPanel());});type("TabWidget",["IWidget"],{_titleTemplate:function(text){return text;},enableTab:function(index){this.tabs[index].dom.style.display='inline';},disableTab:function(index){this.tabs[index].dom.style.display='none';},enable:function(){this.disableOverlay.dom.style.display='none';},disable:function(){this.disableOverlay.dom.style.display='block';},_notifyTabChange:function(from,to){},_drawContent:function(){var self=this;try{each(this.optionDict,function(value,key){if(key==self.selected.get()){value.dom.style.display='block';}else{value.dom.style.display='none';}});}catch(e){if(e=="stopDrawing"){}}},draw:function(dataRetrievalFunc){var self=this;this.tabList=$B(Html.ul("tabList"),this.options,function(value){var liItem=Html.li(value==self.selected.get()?"tabSelected":"tabUnselected",Html.span({},self._titleTemplate(value)));liItem.observeClick(function(){self._notifyTabChange(self.selected.get(),value);self.selected.set(value);});liItem.observeEvent('mouseover',function(){liItem.setStyle('backgroundPosition','0 0px');});liItem.observeEvent('mouseout',function(){liItem.setStyle('backgroundPosition','0 -30px');});self.selected.observe(function(selValue){liItem.dom.className=value==selValue?"tabSelected":"tabUnselected";});self.tabs.push(liItem);return liItem;});var arrow,bg;arrow=Html.div({className:'tabScrollArrow',style:{backgroundPosition:'0 -30px'}});bg=Html.div({className:'tabScrollArrowBg'},arrow);this.scrollArrows.right=[bg,arrow];arrow=Html.div({className:'tabScrollArrow',style:{backgroundPosition:'0 -15px'}});bg=Html.div({className:'tabScrollArrowBg'},arrow);this.scrollArrows.left=[bg,arrow];this.scrollArrows.left[0].observeClick(function(event){self.scrollLeft();});this.scrollArrows.right[0].observeClick(function(event){self.scrollRight();});this.scrollArrows.left[0].observeEvent('mouseover',function(){if(!self.scrollArrowStates.left){return;}
self.scrollArrows.left[0].dom.style.backgroundPosition='0 -75px';});this.scrollArrows.left[0].observeEvent('mouseout',function(){if(!self.scrollArrowStates.left){return;}
self.scrollArrows.left[0].dom.style.backgroundPosition='0 -60px';});this.scrollArrows.right[0].observeEvent('mouseover',function(){if(!self.scrollArrowStates.right){return;}
self.scrollArrows.right[0].dom.style.backgroundPosition='0 -75px';});this.scrollArrows.right[0].observeEvent('mouseout',function(){if(!self.scrollArrowStates.right){return;}
self.scrollArrows.right[0].dom.style.backgroundPosition='0 -60px';});var extraButtons="";if(this.extraButtons.length){extraButtons=Html.div('tabExtraButtons');}
each(this.extraButtons,function(btn,index){var extraCSSClass='';if(index===0){extraCSSClass="buttonContainerLeft";}else if(index==self.extraButtons.length-1){extraCSSClass="buttonContainerRight";}
var btnContainer=Html.div('buttonContainer '+extraCSSClass,btn.btn);extraButtons.append(btnContainer);btnContainer.observeClick(function(){btn.onclick(btnContainer);});});if(dataRetrievalFunc){dataRetrievalFunc.call(this);}else{each(this.optionDict,function(value,key){self.canvas.append(value);});}
this._drawContent();var wrapperStyle=this.width?{width:this.width}:{};this.container=this.IWidget.prototype.draw.call(this,Html.div({style:wrapperStyle},Html.div({className:"tabListContainer",style:{position:'relative'}},this.scrollArrows.left[0],this.scrollArrows.right[0],this.tabList,Html.div('tabGradient',extraButtons)),Html.div({style:{marginTop:pixels(10),width:self.width?self.width:'auto',minHeight:self.height?pixels(self.height):'auto'}},this.canvas),this.disableOverlay));return this.container;},postDraw:function(){var self=this;if(this.tabs.length===0||!this.checkTabOverflow()){return;}
this.tabList.dom.style.paddingLeft="35px";this.tabList.dom.style.paddingRight="35px";for(var i=this.tabs.length-1;i>0;i--){if(self.checkTabOverflow()){this.tabs[i].dom.style.display='none';}else{self.rightTabIndex=i;break;}}
this.scrollArrows.right[0].dom.style.left=pixels(this.container.dom.clientWidth-17);this.setScrollArrowState('right',true);this.setScrollArrowState('left',false);},heightToTallestTab:function(){var currentSelectedTab=this.getSelectedTab();var maxHeight=0;for(var i=this.tabs.length-1;i>=0;i--){this.setSelectedTab(this.options.item(i));maxHeight=Math.max(maxHeight,this.container.dom.offsetHeight);}
this.container.setStyle('height',maxHeight);this.setSelectedTab(currentSelectedTab);},checkTabOverflow:function(tab){return(this.tabList.dom.offsetHeight>(Browser.IE?33:30));},scrollRight:function(){if(!this.scrollArrowStates.right){return;}
var rightTab=this.tabs[this.rightTabIndex];var nextRightTab=this.tabs[this.rightTabIndex+1];this.rightTabIndex++;rightTab.dom.style.marginRight='';nextRightTab.dom.style.display='inline';for(var i=this.leftTabIndex;i<this.tabs.length-1&&this.checkTabOverflow();i++){this.tabs[i].dom.style.display='none';this.tabs[i].dom.style.marginLeft='';this.leftTabIndex++;}
for(i=this.rightTabIndex+1;i<this.tabs.length;i++){this.tabs[i].dom.style.display='inline';this.tabs[i-1].dom.style.marginRight='';if(this.checkTabOverflow()){this.tabs[i].dom.style.display='none';this.tabs[i].dom.style.marginRight='';break;}else{this.rightTabIndex++;}}
this.setScrollArrowState('left',true);if(this.rightTabIndex==this.tabs.length-1){this.setScrollArrowState('right',false);}},scrollLeft:function(){if(!this.scrollArrowStates.left){return;}
var leftTab=this.tabs[this.leftTabIndex];var prevLeftTab=this.tabs[this.leftTabIndex-1];this.leftTabIndex--;leftTab.dom.style.marginLeft='';prevLeftTab.dom.style.display='inline';for(var i=this.rightTabIndex;i>=0&&this.checkTabOverflow();i--){this.tabs[i].dom.style.display='none';this.tabs[i].dom.style.marginRight='';this.rightTabIndex--;}
for(i=this.leftTabIndex-1;i>=0;i--){this.tabs[i].dom.style.display='inline';this.tabs[i+1].dom.style.marginLeft='';if(this.checkTabOverflow()){this.tabs[i].dom.style.display='none';this.tabs[i].dom.style.marginLeft='';break;}
else{this.leftTabIndex--;}}
this.setScrollArrowState('right',true);if(this.leftTabIndex<1){this.setScrollArrowState('left',false);}},setScrollArrowState:function(direction,active){var bg=this.scrollArrows[direction][0];var arrow=this.scrollArrows[direction][1];this.scrollArrowStates[direction]=active;if(active){arrow.dom.style.backgroundPosition='0 -'+pixels(direction=='right'?0:15);arrow.dom.style.borderColor='#999999';bg.dom.style.backgroundPosition='0 -60px';bg.dom.style.cursor='pointer';}else{arrow.dom.style.backgroundPosition='0 -'+pixels(direction=='right'?30:45);arrow.dom.style.borderColor='#D5D5D5';bg.dom.style.backgroundPosition='0 -90px';bg.dom.style.cursor='';}
bg.dom.style.display='block';},getSelectedTab:function(){return this.selected.get();},setSelectedTab:function(newSelectedTab){this.selected.set(newSelectedTab);},initializeDisableOverlay:function(){this.disableOverlay=Html.div({style:{display:'none',background:'white',opacity:'0.7',height:'50px',width:'100%',position:'absolute',top:'0',left:'0',filter:'alpha(opacity=70)'}});}},function(options,width,height,initialSelection,extraButtons,canvas){var self=this;this.width=exists(width)?((typeof(width)=='string'&&width.indexOf('%')>=0)?width:pixels(width)):width;this.height=height;this.tabs=[];this.leftTabIndex=0;this.rightTabIndex=0;this.scrollArrows={};this.scrollArrowStates={};this.extraButtons=any(extraButtons,[]);this.canvas=canvas||Html.div('canvas');if(!exists(initialSelection)){initialSelection=options[0][0];}
this.options=new WatchList();$L(options).each(function(pair){var value=pair[1];var key=pair[0];self.options.append(key);});this.optionDict={};each(options,function(item){self.optionDict[item[0]]=item[1];});this.selected=new WatchValue();this.selected.set(initialSelection);this.selected.observe(function(value){self._drawContent();});this.initializeDisableOverlay();});type("LookupTabWidget",["TabWidget"],{_drawContent:function(){var self=this;try{this.canvas.set(this.optionDict[self.selected.get()]());}catch(e){if(e=="stopDrawing"){}}},draw:function(){return this.TabWidget.prototype.draw.call(this,function(){this.canvas.set(Html.div({}));});}},function(options,width,height,initialSelection,extraButtons,canvas){this.TabWidget(options,width,height,initialSelection,extraButtons,canvas);});var progressIndicator=function(small,center){var htmlTag=small?Html.span:Html.div;return htmlTag(center?{style:{textAlign:'center'}}:{},Html.img({src:imageSrc(small?"loading":"load_big",'gif'),alt:"Loading..."}));};type("PopupWidget",[],{draw:function(content,x,y,styles,setWidth){var self=this;this.x=x;this.y=y;if(!exists(this.canvas)){this.canvas=Html.div({});}
styles=any(styles,{position:'absolute',left:pixels(x),top:pixels(y)});if(setWidth){var width=$('body').width()-x;styles.width=pixels(width);}
$(this.canvas.dom).css(styles).html(content.dom);IndicoUI.assignLayerLevel(this.canvas);if(!addedWebkitJqueryFixDiv&&navigator.userAgent.indexOf('WebKit')!=-1){$('body').append('<div/>');}
addedWebkitJqueryFixDiv=true;return this.canvas;},open:function(x,y){var stuff=this.draw(x,y).dom;$('body').append(stuff);this.isopen=true;this.postDraw();},isOpen:function(){return this.isopen;},postDraw:function(){},close:function(e){var self=this;IndicoUI.unAssignLayerLevel(this.canvas);if(Browser.IE){this.canvas.dom.style.display='none';setTimeout(function(){$E(document.body).remove(self.canvas);},500);}else{$E(document.body).remove(self.canvas);}
this.isopen=false;}},function(styleData){this.canvas=Html.div({style:styleData}||{});});type("HistoryListener",[],{_addToHistory:function(hash){if(this.historyBroker){this.historyBroker.setUserAction(hash);}},registerHistoryBroker:function(broker){this.historyBroker=broker;},notifyHistoryChange:function(hash){this._retrieveHistoryState(hash);}},function(){});type("ErrorAware",[],{_setElementErrorState:function(element,text){return IndicoUtil.markInvalidField(element,text);},setError:function(text){if(!text){if(this._stopErrorList){each(this._stopErrorList,function(elem){elem();});this._stopErrorList=[];}}else{this._setErrorState(text);}
return this._stopErrorList;}},function(){});type("InlineWidget",["IWidget"],{_error:function(error){showErrorDialog(error);}});type("InlineRemoteWidget",["InlineWidget"],{_handleError:function(error){this._error(error);},_handleLoading:function(error){return Html.span({},'loading...');},_handleLoaded:function(){},_handleSuccess:function(){},_handleBackToEditMode:function(){},draw:function(){var self=this;var content=this._handleContent();this.wcanvas=Html.div({},this.loadOnStartup?this._handleLoading():content);this.source.state.observe(function(state){if(state==SourceState.Error){self._handleError(self.source.error.get());self.wcanvas.set(content);self.setMode('edit');self._handleBackToEditMode();}else if(state==SourceState.Loaded){self._handleLoaded(self.source.get());self.wcanvas.set(content);self.setMode('display');self._handleSuccess();}else{self.wcanvas.set(self._handleLoading());}});return self.wcanvas;}},function(method,attributes,loadOnStartup,callback){loadOnStartup=exists(loadOnStartup)?loadOnStartup:true;this.ready=new WatchValue();this.ready.set(false);this.loadOnStartup=loadOnStartup;this.source=indicoSource(method,attributes,null,!loadOnStartup,callback);});type("SelectRemoteWidget",["InlineRemoteWidget","WatchAccessor","ErrorAware"],{_drawItem:function(item){var option=Widget.option(item);if(this.selected.get()){if(this.selected.get()==item.key){option.accessor('selected').set(true);}}
return option;},_setErrorState:function(text){this._stopErrorList=this._setElementErrorState(this.select,text);},_drawNoItems:function(){var option=Widget.option(new WatchPair("None",this.noOptionsText));option.accessor('disabled').set("disabled");option.accessor('selected').set("selected");return option;},_handleContent:function(){var self=this;var options=this.source.get();if(_.size(self.source.get())>0){bind.element(this.select,this.source,function(item){if($.isArray(item)){item=new WatchPair(item[0],item[1]);}else if(!item.key){item=new WatchPair(item,item);}
return self._drawItem(item);});if(self.select.dom.value!=self.selected.get()&&self.showNoValue){var option=Widget.option(new WatchPair("",""));self.select.append(option);option.accessor('selected').set("selected");}
return self.select;}else{self.select.append(self._drawNoItems());return self.select;}},observe:function(func){this.select.observe(func);},refresh:function(){this.source.refresh();},disable:function(){this.select.dom.disabled=true;},enable:function(){this.select.dom.disabled=false;},get:function(){return this.select.get();},set:function(option){this.selected.set(option);},unbind:function(){bind.detach(this.select);},getName:function(){return this.name;}},function(method,args,callback,name,noOptionsText,defaultSelected,showNoValue){this.select=Html.select({'name':name});this.selected=new WatchValue();if(defaultSelected!==undefined){this.set(defaultSelected);}
this.noOptionsText=any(noOptionsText,$T("No options"));this.InlineRemoteWidget(method,args,true,callback);this.loadOnStartup=false;this.name=name;this.showNoValue=any(showNoValue,true);});type("RealtimeTextBox",["IWidget","WatchAccessor","ErrorAware"],{_setErrorState:function(text){this._stopErrorList=this._setElementErrorState(this.input,text);},draw:function(){this.enableEvent();return this.IWidget.prototype.draw.call(this,this.input);},get:function(){if(this.input.dom.disabled){return null;}else{return this.input.get();}},set:function(value){return this.input.set(value);},observe:function(observer){this.observers.push(observer);},observeEvent:function(event,observer){return this.input.observeEvent(event,observer);},observeOtherKeys:function(observer){this.otherKeyObservers.push(observer);},unbind:function(){bind.detach(this.input);},disable:function(){this.input.dom.disabled=true;},enable:function(){this.input.dom.disabled=false;this.enableEvent();},setStyle:function(prop,value){this.input.setStyle(prop,value);},notifyChange:function(keyCode,event){var value=true;var self=this;each(this.observers,function(func){value=value&&func(self.get(),keyCode,event);});return value;},enableEvent:function(){var self=this;this.input.observeEvent('keydown',function(event){var keyCode=event.keyCode;var value=true;if((keyCode<32&&keyCode!=8)||(keyCode>=33&&keyCode<46)||(keyCode>=112&&keyCode<=123)){each(self.otherKeyObservers,function(func){value=value&&func(self.get(),keyCode,event);});return value;}
return true;});this.input.observeEvent('keyup',function(event){var keyCode=event.keyCode;if(!((keyCode<32&&keyCode!=8)||(keyCode>=33&&keyCode<46)||(keyCode>=112&&keyCode<=123))){var value=self.notifyChange(keyCode,event);Dom.Event.dispatch(self.input.dom,'change');return value;}
return true;});}},function(args){this.observers=[];this.otherKeyObservers=[];this.input=Html.input('text',args);});type("RealtimeTextArea",["RealtimeTextBox"],{onChange:function(callback){this.input.observeEvent('change',callback);}},function(args){this.RealtimeTextBox(clone(args));this.input=Html.textarea(args);});type("EnterObserverTextBox",["IWidget","WatchAccessor"],{draw:function(){return this.IWidget.prototype.draw.call(this,this.input);},get:function(){return this.input.get();},set:function(value){return this.input.set(value);},observe:function(observer){this.input.observe(observer);}},function(id,args,keyPressAction){var self=this;this.input=Html.input(id,args);this.input.observeEvent('keypress',function(event){if(event.keyCode==13){Dom.Event.dispatch(self.input.dom,'change');return keyPressAction();}
Dom.Event.dispatch(self.input.dom,'change');});});type("ChainedPopupWidget",["PopupWidget"],{clickTriggersClose:function(target){var result=true;each(this.chainElements,function(element){element=element.ChainedPopupWidget?element.canvas:element;result=result&&!element.ancestorOf(target);});return result&&!this.canvas.ancestorOf(target);},open:function(x,y){var self=this;if(this.active){return;}else{this.active=true;}
this.PopupWidget.prototype.open.call(this,x,y);var handler=function(event){if(self.clickTriggersClose($E(eventTarget(event)))){self.close();each(self.chainElements,function(element){if(element.ChainedPopupWidget){element.close();}});}};$('html').on('click.chained_menu',handler);this.handler=handler;},postDraw:function(){this.PopupWidget.prototype.postDraw.call(this);if(this.alignRight){this.canvas.dom.style.visibility='hidden';this.canvas.dom.style.left=0;this.canvas.dom.style.left=pixels(this.x-this.canvas.dom.offsetWidth);this.canvas.dom.style.visibility='visible';}},close:function(){this.active=false;$('html').off('click.chained_menu',this.handler);this.PopupWidget.prototype.close.call(this);}},function(chainElements,alignRight){this.PopupWidget();this.chainElements=chainElements;this.active=false;this.alignRight=any(alignRight,false);});type("PopupMenu",["ChainedPopupWidget"],{_processItem:function(pair){var self=this;var value=pair.get();var link=Html.a('fake-link',value.display);link.setAttribute("id",pair.key);link.setAttribute("title",value.description);if(typeof value.action=="string"){link.setAttribute('href',value.action);if(self.linkToExternalWindow){link.setAttribute('target','_blank');}
if(value.ajaxDialog){$(link.dom).ajaxDialog({title:value.display});}
if(self.closeOnClick||value.closeOnClick){link.observeClick(function(){self.close();});}}
else{link.observeClick((value.action.PopupWidget||value.action.ExclusivePopup)?function(e){if(self.selected){self.selected.dom.className=null;self.selected=null;}
link.dom.className='selected';self.selected=link;var pos=listItem.getAbsolutePosition();each(self.items,function(item,key){if(item.PopupWidget&&item.isOpen()){item.close();}});var target=pair.get().action;target.open(pos.x+(target.alignRight?0:link.dom.offsetWidth),pos.y-1);return false;}:function(){var ret=pair.get().action(self);if((self.closeOnClick&&ret!==false)||ret===true){self.close();}});}
var listItem=null;if(pair.key===this.currentItem){listItem=Html.li("current",link);}
else{listItem=Html.li({},link);}
return listItem;},close:function(){if(this.closeHandler()){this.ChainedPopupWidget.prototype.close.call(this);}},draw:function(x,y){var self=this;var content=$B(Html.ul(self.cssClass),this.items,function(pair){return self._processItem(pair);});return this.PopupWidget.prototype.draw.call(this,content,x,y);}},function(items,chainElements,cssClass,closeOnClick,alignRight,closeHandler,currentItem,linkToExternalWindow){this.ChainedPopupWidget(chainElements,alignRight);this.items=items;this.currentItem=any(currentItem,[]);this.selected=null;this.cssClass="popupList "+any(cssClass,"");this.closeOnClick=any(closeOnClick,false);this.closeHandler=any(closeHandler,function(){return true;});this.linkToExternalWindow=any(linkToExternalWindow,false);});type("SectionPopupMenu",["PopupMenu"],{draw:function(x,y){var self=this;var sectionContent=Html.ul(self.cssClass);each(this.items,function(item,key){var section=null;if(key!==""){section=Html.li('section',Html.div('line',Html.div('name',key)));section.setAttribute('title',item['description']);}
var tmp=$B(Html.ul('subPopupList'),item['content'],_.bind(self._processItem,self));sectionContent.append(Html.li({},section,tmp));});return this.PopupWidget.prototype.draw.call(this,sectionContent,x,y);}},function(items,chainElements,cssClass,closeOnClick,alignRight,closeHandler){this.ChainedPopupWidget(chainElements,alignRight);this.items=items;this.selected=null;this.cssClass="popupList sectionPopupList "+any(cssClass,"");this.closeOnClick=any(closeOnClick,false);this.closeHandler=any(closeHandler,function(){return true;});});type("CheckPopupWidget",["ChainedPopupWidget"],{draw:function(x,y,maxHeight,styles){var self=this;var optionsId=Html.generateId();this.checkboxes={};var content=null;if(this.options.isEmpty()&&this.noOptionsMessage){content=Html.ul({className:"popupList",style:{maxHeight:pixels(maxHeight),fontStyle:'italic',color:'#444444',padding:pixels(5)}},this.noOptionsMessage);return this.PopupWidget.prototype.draw.call(this,content,x,y,styles);}
content=$B(Html.ul({className:"popupList popupListCheckboxes",style:{maxHeight:pixels(maxHeight),overflowY:'auto',overflowX:'hidden',padding:pixels(2)}}),this.options,function(pair){var optionCheck=Html.checkbox({});optionCheck.dom.name=optionsId;optionCheck.observeClick(function(e){if(!e){e=window.event;}
e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation();}});self.checkboxes[pair.key]=optionCheck;$B(optionCheck,self.object.accessor(pair.key));var color=self.colors.get(pair.key);if(!color){color='transparent';}
var textColor=self.textColors.get(pair.key);if(!textColor){textColor='black';}
var span=Html.span('wrapper',pair.get());var li=Html.li({style:{backgroundColor:color,color:textColor,marginBottom:'2px'}},optionCheck,span);li.observeClick(function(){self.object.set(pair.key,!self.object.get(pair.key));});return li;});return this.PopupWidget.prototype.draw.call(this,content,x,y,styles);},postDraw:function(){var self=this;each(this.checkboxes,function(check,key){if(self.object.get(key)){check.set(true);}});}},function(options,object,colors,textColors,chainElements,noOptionsMessage){this.ChainedPopupWidget(chainElements);this.options=options;this.object=object;this.colors=colors;this.textColors=textColors;this.noOptionsMessage=any(noOptionsMessage,null);});var languages={'en_GB':'en','fr_FR':'fr'};var userLanguage='en_GB';type("RichTextEditor",["IWidget","Accessor"],{draw:function(){var self=this;this.div=Html.div({'id':'text'+this.divId,style:{height:this.height+75,width:this.width}});setTimeout(function(){initializeEditor(self,'text'+self.divId,self.text,self.callbacks,self.width,self.height,self.simple,self.simpleAllowImages);},5);return this.div;},get:function(){if(this.getEditor()&&this.getEditor().getData){return this.getEditor().getData();}else{return'';}},set:function(text){var self=this;if(this.getEditor()&&this.getEditor().setData){this.getEditor().setData(text);}else{this.text=text;}},observe:function(callback){this.callbacks.append(callback);},unbind:function(){this.observing=false;this.callbacks.clear();},onLoad:function(callback){this.onLoadList.append(callback);},destroy:function(){this.unbind();},getEditor:function(){return CKEDITOR.instances["text"+this.divId];},onChange:function(callback){this.getEditor().on('change',callback);},afterPaste:function(callback){this.getEditor().on('afterPaste',callback);}},function(width,height,simple,simpleAllowImages){this.onLoadList=new WatchList();this.callbacks=new WatchList();this.width=width;this.height=height;this.simple=simple;this.simpleAllowImages=simpleAllowImages;this.divId=Html.generateId();});type("RichTextWidget",["IWidget","Accessor"],{draw:function(){this.richDiv.append(this.rich.draw());return Html.div({},this.plain.draw(),this.richDiv,this.hideSwitchLink?null:Widget.link(this.switchLink));},observe:function(callback){var self=this;var observeFunc=function(value){self.plain.unbind();self.rich.unbind();if(value=='rich'){self.rich.observe(function(){callback(self.rich);});}else{self.plain.observe(function(){callback(self.plain);});}};this.selected.observe(observeFunc);observeFunc(this.selected.get());},get:function(){return this.activeAccessor.get();},set:function(value,noDetection){this.currentText=value;if(!any(noDetection,false)){if((Util.Validation.isHtml(value)?'rich':'plain')!=this.selected.get()){this.switchLink.get()(false);}}
if(value&&(this.loaded||this.selected.get()=='plain')){this.activeAccessor.set(value);}},synchronizePlain:function(){this.currentText=this.rich.get();this.plain.set(this.currentText);},synchronizeRich:function(){this.currentText=this.plain.get();this.rich.set(this.currentText);},postDraw:function(){this.rich.postDraw();},destroy:function(){this.rich.destroy();},onChange:function(callback){this.plain.onChange(callback);if(this.loaded){this.rich.onChange(callback);}}},function(width,height,initialText,mode,hideSwitchLink){var textAreaParams={style:{}};textAreaParams.style.width=pixels(width);textAreaParams.style.height=pixels(height);this.plain=new RealtimeTextArea(textAreaParams);this.rich=new RichTextEditor(width,height);this.richDiv=Html.div({});this.currentText=any(initialText,'');this.loaded=false;this.selected=new WatchValue();this.toPlainFunc=function(sync){self.plain.setStyle('display','block');self.richDiv.setStyle('display','none');self.switchLink.set('toRich');self.activeAccessor=self.plain;self.selected.set('plain');if(sync!==false){self.synchronizePlain();}};this.toRichFunc=function(sync){self.plain.setStyle('display','none');self.richDiv.setStyle('display','block');self.switchLink.set('toPlain');self.activeAccessor=self.rich;self.selected.set('rich');if(sync!==false){self.synchronizeRich();}};this.hideSwitchLink=any(hideSwitchLink,false);var self=this;this.switchLink=new Chooser({toPlain:command(self.toPlainFunc,$T("switch to plain text")),toRich:command(self.toRichFunc,$T("switch to rich text"))});if(exists(mode)&&mode=='rich'){self.toRichFunc();}else if(exists(mode)){self.toPlainFunc();}else if(Util.Validation.isHtml(self.currentText)){self.toRichFunc();}else{self.toPlainFunc();}
this.rich.onLoad(function(){self.loaded=true;self.set(self.currentText,true);});});function initializeEditor(wrapper,editorId,text,callbacks,width,height,simple,simpleAllowImages){try{var config={customConfig:false,language:userLanguage,entities:false,width:width,height:height-75,blockedKeystrokes:[9,CKEDITOR.SHIFT+9],keystrokes:[[CKEDITOR.CTRL+75,'link']],removeButtons:'',disableNativeSpellChecker:false,font_names:['Sans Serif/"Liberation Sans", sans-serif','Serif/"Liberation Serif", serif','Monospace/"Liberation Mono", monospace'].join(';'),contentsCss:_.union(CKEDITOR.getUrl('contents.css'),Indico.Urls.FontSassBundle),toolbarGroups:[{name:'clipboard',groups:['clipboard','undo']},{name:'editing',groups:['find','selection','spellchecker']},{name:'links'},{name:'insert'},{name:'forms'},{name:'tools'},{name:'document',groups:['mode','document','doctools']},{name:'others'},'/',{name:'basicstyles',groups:['basicstyles','cleanup']},{name:'paragraph',groups:['list','indent','blocks','align','bidi']},{name:'styles'},{name:'colors'},{name:'about'}],format_tags:'p;h1;h2;h3;pre',removeDialogTabs:'image:advanced;link:advanced'};if(simple){config.toolbar=[{name:'clipboard',items:['Cut','Copy','Paste','PasteText','PasteFromWord','-','Undo','Redo']},{name:'editing',items:['Find','Replace']},{name:'links',items:['Link','Unlink','Anchor']},{name:'insert',items:simpleAllowImages?['Image','HorizontalRule']:['HorizontalRule']},{name:'document',items:['Source']},{name:'basicstyles',items:['Bold','Italic','Underline','Strike','-','RemoveFormat']},{name:'paragraph',items:['NumberedList','BulletedList','-','Outdent','Indent']},{name:'styles',items:['Format']},{name:'colors',items:['TextColor']},{name:'tables',items:['Table']},{name:'tools',items:['Maximize']}];}
CKEDITOR.replace(editorId,config);var cki=CKEDITOR.instances[editorId];cki.setData(text);cki.on('key',function(e)
{each(callbacks,function(func){func();});});cki.on('instanceReady',function(e)
{each(wrapper.onLoadList,function(callback){callback();});});}
catch(error){setTimeout(function(){initializeEditor(wrapper,editorId,text,callbacks,width,height);},5);}}
type("ExclusivePopup",["Printable"],{open:function(){this.draw();this.canvas.dialog('open');},draw:function(content,customStyle,popupStyle){customStyle=customStyle||{};if(!content){content='';}
else if(content.dom){content=content.dom;}
if(popupStyle===undefined){popupStyle=customStyle;}
this.contentContainer=$('<div class="exclusivePopup"/>').css(popupStyle).append(content);this.showCloseButton=!!this.title;this._makeCanvas();this.canvas.empty().css(customStyle).append(this.contentContainer);this.dialogElement.css(customStyle);},close:function(){if(this.isopen){this.canvas.dialog('close');}},_getDialogOptions:function(){return{};},_makeCanvas:function(){if(!this.canvas){var opts=$.extend(true,{autoOpen:false,draggable:true,modal:true,resizable:false,closeOnEscape:true,title:this.title,minWidth:'250px',minHeight:0,open:$.proxy(this._onOpen,this),close:$.proxy(this._onClose,this),beforeClose:$.proxy(this._onBeforeClose,this)},this._getDialogOptions());this.canvas=$('<div/>').dialog(opts);}
if(!this.dialogElement){this.dialogElement=this.canvas.dialog('widget');}
this.buttons=this.dialogElement.find('.ui-dialog-buttonset button');},_onBeforeClose:function(e){if(e.originalEvent&&$(e.originalEvent.currentTarget).hasClass('ui-dialog-titlebar-close')){if(isFunction(this.closeHandler)&&!this.closeHandler()){return false;}}
else if(e.originalEvent&&e.originalEvent.keyCode===$.ui.keyCode.ESCAPE){e.stopPropagation();if(this.closeHandler===null||!this.showCloseButton){this.canvas.find('[data-button-back]').trigger('click');return false;}
if(isFunction(this.closeHandler)&&!this.closeHandler()){return false;}}},_onOpen:function(e){this.isopen=true;if(this.closeHandler===null||!this.showCloseButton){this.dialogElement.find('.ui-dialog-titlebar-close').hide();if(!this.title){this.dialogElement.find('.ui-dialog-titlebar').hide();}}
if(this.postDraw()===true){var pos=this.canvas.dialog('option','position');this.canvas.dialog('option','position',pos);}},postDraw:function(){},_onClose:function(e,ui){this.isopen=false;this.canvas.dialog('destroy');this.canvas.remove();this.canvas=this.dialogElement=null;this.buttons=[];}},function(title,closeButtonHandler,printable,showPrintButton,noCanvas){this.title=any(title,null);this.closeHandler=any(closeButtonHandler,positive);this.showCloseButton=false;this.maxHeight=600;this.printable=any(printable,true);this.showPrintButton=any(showPrintButton&&title&&printable,false);this.buttons=$();if(!noCanvas){this._makeCanvas();}});type("ExclusivePopupWithButtons",["ExclusivePopup"],{_getButtons:function(){return null;},_getDialogOptions:function(){var self=this;var buttons=this._getButtons();var dlgButtons=[];this.defaultButton=null;if(buttons){$.each(buttons,function(i,button){dlgButtons.push({text:button[0],click:button[1]});if(button.length>2&&button[2]){self.defaultButton=i;}});}
return{buttons:dlgButtons};},_onOpen:function(e){this.ExclusivePopup.prototype._onOpen.call(this,e);if(this.defaultButton!==null){this.buttons[this.defaultButton].focus();}
this.canvas.scrollblocker({overflowType:"auto"});},_onClose:function(e){this.ExclusivePopup.prototype._onClose.call(this,e);$("body").off("mousewheel wheel");}},function(title,closeButtonHandler,printable,showPrintButton,noCanvas){this.ExclusivePopup(title,closeButtonHandler,printable,showPrintButton,noCanvas);});type("AlertPopup",["ExclusivePopupWithButtons"],{draw:function(){var content=$('<div/>').css({maxWidth:'400px',padding:'10px',textAlign:'center'}).append($('<div/>').css('textAlign','left').html(this.content));return this.ExclusivePopupWithButtons.prototype.draw.call(this,content);},_getButtons:function(){var self=this;return[[$T('OK'),function(){self.close();self.callback();}]];}},function(title,content,callback){if(content.dom){content=content.dom;}
this.content=content;this.callback=callback||positive;this.ExclusivePopupWithButtons(title,this.callback);});type("ConfirmPopup",["ExclusivePopupWithButtons"],{draw:function(){return this.ExclusivePopup.prototype.draw.call(this,this.content,this.style);},_getButtons:function(){var self=this;return[[$T(this.buttonTitle),function(){self.close();self.handler(true);}],[$T(this.cancelButtonTitle),function(){self.close();self.handler(false);}]];}},function(title,content,handler,buttonTitle,cancelButtonTitle,style){var self=this;this.buttonTitle=buttonTitle||'OK';this.cancelButtonTitle=cancelButtonTitle||'Cancel';this.style=style||{};this.content=content;this.handler=handler;this.ExclusivePopupWithButtons(title,function(){self.handler(false);return true;});});type("ConfirmPopupWithPM",["ConfirmPopup"],{_getButtons:function(){var self=this;return[[$T(this.buttonTitle),function(){if(self.parameterManager.check()){self.handler(true);}}],[$T(this.cancelButtonTitle),function(){self.close();self.handler(false);}]];}},function(title,content,handler,buttonTitle,cancelButtonTitle){this.parameterManager=new IndicoUtil.parameterManager();this.ConfirmPopup(title,content,handler,buttonTitle,cancelButtonTitle);});type('ConfirmPopupWithReason',['ConfirmPopupWithPM'],{},function(title,content,handler,buttonTitle,cancelButtonTitle){this.reason=Html.textarea({style:{width:'100%'}});this.ConfirmPopupWithPM(title,Html.div({},content,Html.div({style:{marginTop:pixels(10)}},Html.div({style:{fontWeight:"bold"}},$T("Reason: ")),this.reason)),handler,buttonTitle,cancelButtonTitle);this.parameterManager.add(this.reason,'text',false);});type("SpecialRemovePopup",["ExclusivePopupWithButtons"],{draw:function(){return this.ExclusivePopupWithButtons.prototype.draw.call(this,this.content);},_getButtons:function(){var self=this;return[[$T(this.buttonTitle1),function(){self.close();self.handler(1);}],[$T(this.buttonTitle2),function(){self.close();self.handler(2);}],[$T('Cancel'),function(){self.close();self.handler(0);}]];}},function(title,content,handler,buttonTitle1,buttonTitle2){var self=this;this.buttonTitle1=buttonTitle1;this.buttonTitle2=buttonTitle2;this.content=content;this.handler=handler;this.ExclusivePopupWithButtons(title,function(){self.handler(0);return true;});});type("WarningPopup",["AlertPopup"],{_formatLine:function(line){var result=Html.div({paddingBottom:pixels(2)});var linkStart=0;var linkMiddle;var linkEnd=0;while(linkStart>=0){linkStart=line.indexOf('[[',linkEnd);if(linkStart>=0){result.append(Html.span('',line.substring(linkEnd,linkStart)));linkMiddle=line.indexOf(' ',linkStart);linkEnd=line.indexOf(']]',linkStart);result.append(Html.a({href:line.substring(linkStart+2,linkMiddle)},line.substring(linkMiddle+1,linkEnd)));linkEnd+=2;}else{result.append(Html.span('',line.substring(linkEnd,line.length)));}}
return result;},_formatContent:function(content,level){var self=this;if(isString(content)){return Html.span('',self._formatLine(content));}else if(isArray(content)){var result=Html.ul(level===0?'warningLevel0':'warningLevel1');each(content,function(line){if(isString(line)){result.append(Html.li({},self._formatLine(line)));}else if(isArray(line)){result.append(self._formatContent(line,level+1));}else{result.append(Html.li({},line));}});return result;}}},function(title,lines){this.AlertPopup(title,this._formatContent(lines,0).dom);});type("ErrorPopup",["ExclusivePopup"],{draw:function(){var errorList=null;if(this.errors.length==1){errorList=Html.div({className:"errorList"},this.errors[0]);}else{errorList=Html.ul("errorList");each(this.errors,function(e){errorList.append(Html.li('',e));});}
return this.ExclusivePopup.prototype.draw.call(this,Widget.block([errorList,this.afterMessage]).dom);}},function(title,errors,afterMessage){this.afterMessage=afterMessage;this.errors=errors;this.ExclusivePopup(title,positive);});type("DateRangeSelector",["ExclusivePopupWithButtons"],{_getButtons:function(){var self=this;return[[$T('Choose'),function(){self._submit()}],[$T('Cancel'),function(){self.close()}]];},_submit:function(){if(!this._verifyDates()){new AlertPopup($T('Invalid date range'),$T('The selected date range is invalid.')).open();return;}
this.callback(this.startDate,this.endDate);},_dateFromString:function(dateStr){return new Date(dateStr);},_verifyDates:function(){var dates=this.dateRangeWidget.daterange('getDates');var sDate=dates[0];var eDate=dates[1];if(sDate>eDate||(!this.allowEqual&&(sDate-eDate)==0)){return false;}
this.startDate=sDate;this.endDate=eDate;return true;},_drawWidget:function(){var self=this;self.dateRangeWidget=$('<div/>');return self.dateRangeWidget;},postDraw:function(){this.dateRangeWidget.daterange({allowPast:true,useFields:false,startDate:this.startDate,endDate:this.endDate,pickerOptions:{yearRange:'c-2:c+2'}});return true;},draw:function(){return this.ExclusivePopupWithButtons.prototype.draw.call(this,this._drawWidget(),{overflow:'visible'});}},function(startDate,endDate,callback,title,allowEqual){var self=this;this.callback=callback;this.allowEqual=allowEqual||false;this.dateRangeWidget=null;if(startDate&&typeof startDate=='string'){startDate=this._dateFromString(startDate);}
if(endDate&&typeof endDate=='string'){endDate=this._dateFromString(endDate);}
this.startDate=startDate||new Date();this.endDate=endDate||new Date();this.ExclusivePopupWithButtons(title||'Choose date range',function(){self.close();});});type("PreLoadHandler",[],{execute:function(){var self=this;if(this.counter===0){this.process();}else{$L(this.actionList).each(function(preloadItem){var hook=new WatchValue();hook.set(false);hook.observe(function(value){if(value){bind.detach(hook);self.counter--;if(self.counter===0){self.process();}}});if(preloadItem.PreLoadAction){preloadItem.run(hook);}else{preloadItem.call(self,hook);}});}}},function(list,process){this.actionList=list;this.counter=list.length;this.process=process;});type("ProgressDialog",["ExclusivePopup"],{draw:function(){return this.ExclusivePopup.prototype.draw.call(this,$('<div class="loadingPopup"/>').append($('<div class="text"/>').html(this.text)),{background:'#424242',border:'none',padding:'20px',overflow:'visible'},{background:'#424242',border:'none',padding:'1px',overflow:'auto',display:"inline"});}},function(text){if(text===undefined){this.text=$T('Loading...');}else{this.text=text;}
this.ExclusivePopup();});IndicoUI.Dialogs={};(function(global){'use strict';var ERROR_DIALOG_TEMPLATE=_.template('<div class="error-dialog">'+'    <div class="error-message-box">'+'        <div class="message-text"><%= errorText %></div>'+'    </div>'+'    <p class="js-info-text"><%= infoText %></p>'+'    <div class="actions">'+'        <button class="i-button big warning js-report-button"'+'                data-href="<%= url %>"'+'                data-title="<%= reportText %>"'+'                data-ajax-dialog>'+'            <%= reportText %>'+'        </button>'+'        <button class="i-button big" data-button-back><%= closeText %></button>'+'    </div>'+'</div>');global.showErrorDialog=function showErrorDialog(error){var $content=$(ERROR_DIALOG_TEMPLATE({errorText:error.message,infoText:$T.gettext('Please reload the page and report this error to us if it persists.'),reportText:$T.gettext('Report Error'),closeText:$T.gettext('Close'),url:error.report_url}));$content.on('ajaxDialog:closed',function(evt,data){if(data){$content.find('.js-report-button').prop('disabled',true);$content.find('.js-info-text').text($T.gettext('Thanks for your error report!'));}});ajaxDialog({content:$content,title:error.title,onOpen:function(){if(!error.report_url){$content.find('.js-report-button').remove();$content.find('.js-info-text').remove();}}});};IndicoUI.Dialogs.Util={progress:function(text){var dialog=new ProgressDialog(text);dialog.open();return function(){dialog.close();};}};})(window);function userListNothing(data,func){func(true,data);}
function singleUserNothing(user,func){func(true);}
function create_favorite_button(user_id){var integerRegex=/^[0-9]+$/;if(!integerRegex.test(user_id)){return $('<span>');}
var active=!!Indico.User.favorite_users[user_id],span=$('<span class="favorite-user icon-star">').attr({title:active?$T('Remove from your list of favorite users'):$T('Add to your list of favorite users'),'data-id':user_id}).on('click',function(e){e.stopPropagation();$(document).trigger('favorites.'+($(this).hasClass('active')?'remove-user':'add-user'),user_id);});if(active){span.addClass('active');}
return span;}
$(function(){$(document).on('favorites.remove-user',function(e,user_id){$.ajax({url:build_url(Indico.Urls.FavoriteUserRemove,{fav_user_id:user_id}),method:'DELETE',error:handleAjaxError}).done(function(){$('.favorite-user[data-id='+user_id+']').removeClass('active');delete Indico.User.favorite_users[user_id];});}).on('favorites.add-user',function(e,user_id){$.ajax({url:Indico.Urls.FavoriteUserAdd,method:'POST',dataType:'json',data:{user_id:[user_id]},error:handleAjaxError}).done(function(result){$('.favorite-user[data-id='+user_id+']').addClass('active');Indico.User.favorite_users[user_id]=result.users[0];});});});type("FoundPeopleList",["SelectableListWidget"],{_drawItem:function(pair){var self=this;var peopleData=pair.get();if(peopleData.get('isGroup')||peopleData.get('_type')==='group'){return Html.div("info",Html.span("name",peopleData.get("name")));}else{var userName=Html.span("name",peopleData.get("firstName"),' ',peopleData.get("familyName"));var userEmail=Html.span({id:self.id+"_"+pair.key+"_email",className:"email"},Util.truncate(peopleData.get("email"),40));var affiliation=Html.$($('<span class="affiliation">').text(peopleData.get('affiliation')));var html=Html.div("info",userName,userEmail,affiliation);var $actionButtons=$('<div>',{'class':'actions'});if(this.showToggleFavouriteButtons&&IndicoGlobalVars.isUserAuthenticated&&peopleData.get('_type')=="Avatar"){var favouritizeButtonDiv=create_favorite_button(peopleData.get('id')).get(0);$actionButtons.append(favouritizeButtonDiv);}
if(peopleData.get('_type')=='EventPerson'){var userId=peopleData.get('user_id');if(userId){$actionButtons.append(create_favorite_button(userId));}
$('<span>',{'class':'event-person','title':$T("This person exists in the event")}).appendTo($actionButtons);}
return[html,new Html.$($actionButtons)];}}},function(style,onlyOne,selectionObserver,showToggleFavouriteButtons,favouriteButtonObserver){if(!exists(style)){style="user-list";}
this.onlyOne=any(onlyOne,false);this.showToggleFavouriteButtons=any(showToggleFavouriteButtons,true);this.favouriteButtonObserver=any(favouriteButtonObserver,null);this.SelectableListWidget(selectionObserver,this.onlyOne,style,"selected","unselected");});type("SimpleSearchPanel",["IWidget"],{_searchAction:function(){Dom.Event.dispatch(this.searchButton.dom,'click');},_createSearchForm:function(){},_search:function(){},_createAuthenticatorSearch:function(){var self=this;if(empty(Indico.Settings.ExtAuthenticators)||!this.allowExternal){return null;}else{var searchExternalCB=Html.checkbox({});$B(searchExternalCB,self.criteria.accessor('search-ext'));return[[$T("Users with no Indico account"),searchExternalCB]];}},getSelectedList:function(){return this.foundPeopleList.getSelectedList();},clearSelection:function(){this.foundPeopleList.clearSelection();},draw:function(){var self=this;this.searchForm=this._createSearchForm();this.searchButton=Html.input("button",{},$T("Search"));this.searchButtonDiv=Html.div("searchUsersButtonDiv",this.searchButton);this.searchButton.observeClick(function(){self._search();});this.foundPeopleListDiv=Html.div("user-search-results",this.foundPeopleList.draw());this.container=Html.div({},this.searchForm.get(),this.searchButtonDiv,this.foundPeopleListDiv,this.extraDiv);if(this.submissionRights){var checkbox=Html.checkbox({},true);$B(this.grantRights.accessor('submission'),checkbox);var submissionDiv=Html.div({style:{marginTop:pixels(5),marginLeft:pixels(-4)}},checkbox,$T("Grant all selected users submission rights"));this.container.append(submissionDiv);}
return this.IWidget.prototype.draw.call(this,this.container);}},function(onlyOne,selectionObserver,showToggleFavouriteButtons,favouriteButtonObserver,submissionRights,grantRights,extraDiv,allowExternal){this.IWidget();this.onlyOne=any(onlyOne,false);this.criteria=new WatchObject();this.foundPeopleList=new FoundPeopleList(null,this.onlyOne,selectionObserver,showToggleFavouriteButtons,favouriteButtonObserver);this.foundPeopleList.setMessage($T("You can use the form above to search for users..."));this.extraDiv=any(extraDiv,Html.div({}));this.searchForm=null;this.searchButton=null;this.searchButtonDiv=null;this.foundPeopleListDiv=null;this.container=null;this.submissionRights=submissionRights;this.grantRights=grantRights;this.allowExternal=allowExternal;});type("UserSearchPanel",["SimpleSearchPanel"],{_createSearchForm:function(){var self=this,do_search=function(){self._searchAction();return false;};this.fields={'surName':new EnterObserverTextBox("text",{style:{width:"100%"},id:'userSearchFocusField'},do_search),'name':new EnterObserverTextBox("text",{style:{width:"100%"}},do_search),'email':new EnterObserverTextBox("text",{style:{width:"100%"}},do_search),'organisation':new EnterObserverTextBox("text",{style:{width:"100%"}},do_search),'exactMatch':Html.checkbox({})};var fieldList=[[$T("Family name"),this.fields.surName.draw()],[$T("First name"),this.fields.name.draw()],[$T("E-mail"),this.fields.email.draw()],[$T("Organisation"),this.fields.organisation.draw()],[$T("Exact Match"),this.fields.exactMatch]];var authenticatorSearch=this._createAuthenticatorSearch();if(exists(authenticatorSearch)){fieldList=concat(fieldList,authenticatorSearch);}
return IndicoUtil.createFormFromMap(fieldList,true);},_search:function(){var self=this;self.searchButton.dom.disabled=true;this.foundPeopleList.setMessage(Html.div({style:{paddingTop:'20px'}},progressIndicator(false,true)));_.each(this.fields,function(widget,key){self.criteria.set(key,widget.get());});indicoRequest('search.users',self.criteria,function(result,error){if(!error){self.foundPeopleList.clearList();if(result.length===0){self.foundPeopleList.setMessage($T("No results for this search..."));}else{each(result,function(entry){if(entry._type==="Avatar"){self.foundPeopleList.set('existingAv'+entry.id,$O(entry));}else if(entry._type==="EventPerson"){self.foundPeopleList.set('existingEventPerson'+entry.id,$O(entry));}});}
self.searchButton.dom.disabled=false;}else{self.foundPeopleList.clearList();showErrorDialog(error);}});},draw:function(){return this.SimpleSearchPanel.prototype.draw.call(this);}},function(onlyOne,selectionObserver,conferenceId,showToggleFavouriteButtons,favouriteButtonObserver,submissionRights,grantRights,extraDiv,allowExternal){this.SimpleSearchPanel(onlyOne,selectionObserver,showToggleFavouriteButtons,favouriteButtonObserver,submissionRights,grantRights,extraDiv,allowExternal);if(exists(conferenceId)){this.criteria.set("conferenceId",conferenceId);}
this.fields={};});type("GroupSearchPanel",["SimpleSearchPanel"],{_createSearchForm:function(){var self=this;var groupName=new EnterObserverTextBox("text",{style:{width:"100%"}},function(){self._searchAction();return false;});var exactMatch=Html.checkbox({});$B(groupName,this.criteria.accessor('group'));$B(exactMatch,this.criteria.accessor('exactMatch'));this.criteria.set('exactMatch',true);var fieldList=[[$T("Group name"),groupName.draw()],[$T("Exact Match"),exactMatch]];return IndicoUtil.createFormFromMap(fieldList,true);},_search:function(){var self=this;self.searchButton.dom.disabled=true;this.foundPeopleList.setMessage(Html.div({style:{paddingTop:'20px'}},progressIndicator(false,true)));indicoRequest('search.groups',self.criteria,function(result,error){if(!error){self.foundPeopleList.clearList();if(result.length===0){self.foundPeopleList.setMessage($T("No results for this search..."));}else{each(result,function(group){self.foundPeopleList.set(group.name,$O(group));});}
self.searchButton.dom.disabled=false;}else{self.foundPeopleList.clearList();showErrorDialog(error);}});},draw:function(){return this.SimpleSearchPanel.prototype.draw.call(this);}},function(onlyOne,selectionObserver,conferenceId,showToggleFavouriteButtons){this.SimpleSearchPanel(onlyOne,selectionObserver,conferenceId,showToggleFavouriteButtons);});type("UserAndGroupsSearchPanel",["IWidget"],{__selectionObserver:function(panel,selectedList){if(this.onlyOne){if(panel==="users"){this.groupPanel.clearSelection();}else{this.userPanel.clearSelection();}
this.parentSelectionObserver(selectedList);}else{var totalSelection=$O();totalSelection.update(this.userPanel.getSelectedList().getAll());totalSelection.update(this.groupPanel.getSelectedList().getAll());this.parentSelectionObserver(totalSelection);}},getSelectedList:function(){var totalSelection=$O();totalSelection.update(this.userPanel.getSelectedList().getAll());totalSelection.update(this.groupPanel.getSelectedList().getAll());return totalSelection;},clearSelection:function(){this.userPanel.clearSelection();this.groupPanel.clearSelection();},draw:function(){this.tabWidget=new JTabWidget([[$T("Users"),this.userPanel.draw()],[$T("Groups"),this.groupPanel.draw()]]);return this.IWidget.prototype.draw.call(this,this.tabWidget.draw());}},function(onlyOne,selectionObserver,conferenceId,showToggleFavouriteButtons,favouriteButtonObserver,submissionRights,grantRights,extraDiv,allowExternal){this.IWidget();this.onlyOne=any(onlyOne,false);this.parentSelectionObserver=selectionObserver;var self=this;this.userPanel=new UserSearchPanel(this.onlyOne,function(selectedList){self.__selectionObserver("users",selectedList);},conferenceId,showToggleFavouriteButtons,favouriteButtonObserver,submissionRights,grantRights,extraDiv,allowExternal);this.groupPanel=new GroupSearchPanel(this.onlyOne,function(selectedList){self.__selectionObserver("groups",selectedList);},showToggleFavouriteButtons);this.tabWidget=null;});type("SuggestedUsersPanel",["IWidget"],{getSelectedList:function(){return this.suggestedUserList.getSelectedList();},clearSelection:function(){this.suggestedUserList.clearSelection();},draw:function(){var self=this;this.titleDiv=Html.div("suggestedUsersTitle",Html.span({},$T("Suggested users")));if(this.suggestedUserList.isEmpty()){var message=Html.span({},$T("There are no suggested users for you at the moment. Why not add some "),Html.a({href:Indico.Urls.Favorites},$T("favourites")),"?");this.suggestedUserList.setMessage(message);}
this.suggestedUserListDiv=Html.div("suggested-users",this.suggestedUserList.draw());return this.IWidget.prototype.draw.call(this,Widget.block([this.titleDiv,this.suggestedUserListDiv]));}},function(onlyOne,includeFavourites,suggestedUsers,selectionObserver,showToggleFavouriteButtons){this.IWidget();this.onlyOne=any(onlyOne,false);includeFavourites=any(includeFavourites,true);this.suggestedUserList=new FoundPeopleList(null,this.onlyOne,selectionObserver,showToggleFavouriteButtons);var self=this;if(exists(suggestedUsers)){each(suggestedUsers,function(user){if(any(user._type,null)==="Avatar"){self.suggestedUserList.set('existingAv'+user.id,$O(user));}else{self.suggestedUserList.set(user.id,$O(user));}});}
if(includeFavourites){var favorites=_.values(Indico.User.favorite_users).sort(function(a,b){var name1='{0} {1}'.format(a.firstName,a.familyName);var name2='{0} {1}'.format(b.firstName,b.familyName);return(name1==name2)?0:(name1<name2)?-1:1;});_.each(favorites,function(user){if(!self.suggestedUserList.get('existingAv'+user.id)){self.suggestedUserList.set('existingAv'+user.id,$O(user));}});}
this.titleDiv=null;this.suggestedUserListDiv=null;});type("ChooseUsersPopup",["ExclusivePopupWithButtons","PreLoadHandler"],{_preload:[],__buildSearchPanel:function(container){var self=this;if(this.enableGroups){this.searchPanel=new UserAndGroupsSearchPanel(this.onlyOne,function(selectedList){self.__selectionObserver("searchUsers",selectedList);},this.conferenceId,this.showToggleFavouriteButtons,function(avatar,action){self.__searchPanelFavouriteButtonObserver(avatar,action);},this.submissionRights,this.grantRights,self.extraDiv,self.allowExternal);}else{this.searchPanel=new UserSearchPanel(this.onlyOne,function(selectedList){self.__selectionObserver("searchUsers",selectedList);},this.conferenceId,this.showToggleFavouriteButtons,function(avatar,action){self.__searchPanelFavouriteButtonObserver(avatar,action);},this.submissionRights,this.grantRights,self.extraDiv,self.allowExternal);}
var returnedDom=this.searchPanel.draw();container.append(returnedDom);},__buildSuggestedUsersPanel:function(container){var self=this;this.suggestedUsersPanel=new SuggestedUsersPanel(this.onlyOne,this.includeFavourites,this.suggestedUsers,function(selectedList){self.__selectionObserver("suggestedUsers",selectedList);},this.showToggleFavouriteButtons);container.append(this.suggestedUsersPanel.draw());},__selectionObserver:function(panel,selectedList){if(this.onlyOne){if(panel==="searchUsers"){this.suggestedUsersPanel.clearSelection();}else{this.searchPanel.clearSelection();}
if(selectedList.isEmpty()){this._toggleSaveButton(false);}else{this._toggleSaveButton(true);}}else{if(!selectedList.isEmpty()){this._toggleSaveButton(true);}else{var twoPanels=this.allowSearch&&(this.includeFavourites||exists(this.suggestedUsers));if(twoPanels){var otherSelectedList=(panel==="searchUsers")?this.suggestedUsersPanel.getSelectedList():this.searchPanel.getSelectedList();if(otherSelectedList.isEmpty()){this._toggleSaveButton(false);}else{this._toggleSaveButton(true);}}else{this._toggleSaveButton(false);}}}},__save:function(){var self=this;var totalSelected=$O({});if(this.allowSearch){totalSelected.update(this.searchPanel.getSelectedList().getAll());}
if(this.includeFavourites||exists(this.suggestedUsers)){totalSelected.update(this.suggestedUsersPanel.getSelectedList().getAll());}
var returnedList=new List();each(totalSelected,function(selectedItem){if(self.submissionRights){selectedItem.set('isSubmitter',self.grantRights.get('submission'));}
returnedList.append(selectedItem.getAll());});this.chooseProcess(returnedList.allItems());},__searchPanelFavouriteButtonObserver:function(avatar,addedOrRemoved){if(addedOrRemoved){this.suggestedUsersPanel.suggestedUserList.set('existingAv'+avatar.id,$O(avatar));}},_toggleSaveButton:function(enabled){this.saveButton.disabledButtonWithTooltip(enabled?'enable':'disable');},draw:function(){var self=this;this.saveButton=self.buttons.eq(0);this.saveButton.disabledButtonWithTooltip({tooltip:$T('Please select at least one item'),disabled:true});var mainContent=Html.tr();if(self.allowSearch){this.cellSearch=Html.td("searchUsersGroupsPanel");self.__buildSearchPanel(this.cellSearch);mainContent.append(this.cellSearch);}
if(this.includeFavourites||exists(this.suggestedUsers)){this.cellSuggested=Html.td("suggestedUsersPanel");self.__buildSuggestedUsersPanel(this.cellSuggested);mainContent.append(this.cellSuggested);}
mainContent=Html.table({cellpadding:0,cellPadding:0,cellspacing:0,cellSpacing:0},Html.tbody({},mainContent));return this.ExclusivePopupWithButtons.prototype.draw.call(this,mainContent,{padding:'0px'});},_getButtons:function(){var self=this;return[[(self.onlyOne?$T('Choose'):$T('Add')),function(){self.__save();self.close();}],[$T('Cancel'),function(){self.close();}]];},postDraw:function(){if(this.allowSearch&&this.enableGroups){var tabContainer=this.searchPanel.tabWidget.canvas;tabContainer.height(tabContainer.height());}
if(this.includeFavourites||exists(this.suggestedUsers)){this.suggestedUsersPanel.suggestedUserListDiv.setStyle('height',pixels(this.cellSuggested.dom.offsetHeight-this.suggestedUsersPanel.titleDiv.dom.offsetHeight-10));}
this.ExclusivePopupWithButtons.prototype.postDraw.call(this);if(this.allowSearch)
$E('userSearchFocusField').dom.focus();}},function(title,allowSearch,conferenceId,enableGroups,includeFavourites,suggestedUsers,onlyOne,showToggleFavouriteButtons,submissionRights,chooseProcess,extraDiv,allowExternal){var self=this;this.allowSearch=allowSearch;this.conferenceId=conferenceId;this.enableGroups=enableGroups;this.includeFavourites=any(includeFavourites,true);this.suggestedUsers=suggestedUsers;this.onlyOne=any(onlyOne,false);this.showToggleFavouriteButtons=any(showToggleFavouriteButtons,true);this.chooseProcess=chooseProcess;this.extraDiv=extraDiv;this.saveButton=null;this.suggestedUsersPanel=null;this.searchPanel=null;this.buttonDiv=null;this.cellSearch=null;this.cellSuggested=null;this.submissionRights=submissionRights;this.grantRights=new WatchObject();this.PreLoadHandler(self._preload,function(){self.open();});this.ExclusivePopupWithButtons(title,positive);this.allowExternal=_.isBoolean(allowExternal)?allowExternal:true;});type("UserDataPopup",["ExclusivePopupWithButtons"],{draw:function(){var userData=this.userData;var self=this;self.parameterManager=new IndicoUtil.parameterManager();var grantSubmission=[];var grantManagement=[];var grantCoordination=[];var warning=[];if(this.grantSubmission){grantSubmission=[$T('Grant submission rights'),$B(Html.checkbox({id:'submissionCheckbox'}),userData.accessor('submission'))];warning=[Html.span({},Html.span({style:{fontWeight:'bold'}},$T('Note:')),$T(' If this person does not already have an Indico account, '),Html.br(),$T('he or she will be sent an email asking to register as a user.'),Html.br(),$T(' After the registration the user will automatically be given'),Html.br(),$T(' submission rights.'))];}
if(this.grantManagement){grantManagement=[$T('Give management rights'),$B(Html.checkbox({}),userData.accessor('manager'))];warning=[Html.span({},Html.span({style:{fontWeight:'bold'}},$T('Note:')),$T(' If this person does not already have an Indico account, '),Html.br(),$T('he or she will be sent an email asking to create an account.'),Html.br(),$T(' After the account creation the user will automatically be'),Html.br(),$T(' given management rights.'))];}
if(this.grantCoordination){grantCoordination=[$T('Give coordination rights'),$B(Html.checkbox({}),userData.accessor('coordinator'))];warning=[Html.span({},Html.span({style:{fontWeight:'bold'}},$T('Note:')),$T(' If this person does not already have an Indico account, '),Html.br(),$T('he or she will be sent an email asking to create an account.'),Html.br(),$T(' After the account creation the user will automatically be'),Html.br(),$T(' given coordination rights.'))];}
if(this.grantManagement&&this.grantCoordination){warning=[Html.span({},Html.span({style:{fontWeight:'bold'}},$T('Note:')),$T(' If this person does not already have an Indico account, '),Html.br(),$T('he or she will be sent an email asking to create an account.'),Html.br(),$T(' After the account creation the user will automatically be'),Html.br(),$T(' given the rights.'))];}
var form=IndicoUtil.createFormFromMap([[$T('Title'),$B(Html.select({},Html.option({},""),Html.option({value:'Mr.'},$T("Mr.")),Html.option({value:'Mrs.'},$T("Mrs.")),Html.option({value:'Ms.'},$T("Ms.")),Html.option({value:'Dr.'},$T("Dr.")),Html.option({value:'Prof.'},$T("Prof."))),userData.accessor('title'))],[$T('Family Name'),$B(self.parameterManager.add(Html.edit({style:{width:'300px'}}),'text',false),userData.accessor('familyName'))],[$T('First Name'),$B(Html.edit({style:{width:'300px'}}),userData.accessor('firstName'))],[$T('Affiliation'),$B(Html.edit({style:{width:'300px'}}),userData.accessor('affiliation'))],[$T('Email'),$B(self.parameterManager.add(Html.edit({id:"email",style:{width:'300px'}}),'email',this.allowEmptyEmail),userData.accessor('email'))],[$T('Address'),$B(Html.textarea({style:{width:'300px'}}),userData.accessor('address'))],[$T('Telephone'),$B(Html.edit({style:{width:'300px'}}),userData.accessor('phone'))],grantSubmission,grantManagement,grantCoordination,warning]);return this.ExclusivePopupWithButtons.prototype.draw.call(this,form);},_getButtons:function(){var self=this;return[[$T('Save'),function(){if($('#submissionCheckbox').is(':checked')&&$('#email').val()==0){var popup=new WarningPopup($T('Warning'),$T("It is not possible to grant submission rights to a participant without an email address. Please set an email address."));popup.open();return;}
self.userData.set('name','{0} {1}'.format(self.userData.get('firstName'),self.userData.get('familyName')));if(self.parameterManager.check()&&self.checkPerson(self.userData)){self.action(self.userData);if(self.autoClose){self.close();}}}],[$T('Cancel'),function(){self.close();}]];}},function(title,userData,action,grantSubmission,grantManagement,grantCoordination,allowEmptyEmail,autoClose,checkPerson){this.userData=userData;this.action=action;this.grantSubmission=exists(grantSubmission)?grantSubmission:false;this.grantManagement=exists(grantManagement)?grantManagement:false;this.grantCoordination=exists(grantCoordination)?grantCoordination:false;this.allowEmptyEmail=exists(allowEmptyEmail)?allowEmptyEmail:true;this.ExclusivePopup(title,function(){return true;});this.autoClose=exists(autoClose)?autoClose:true;this.checkPerson=checkPerson||function(){return true;};});$(function(){$.widget("users.shield",{options:{userData:null,submission:true},_qtip:function(rights){var rightsTooltipText=$("<div></div>").append($("<span></span>").text($T("User privileges")).css('fontSize','13px')).append($("<div></div>").css('marginTop','8px'));$.each(rights,function(index,value){rightsTooltipText.append(value.checkbox).append($("<span></span>").text(value.text).css('verticalAlign','middle'));});this.element.qtip({style:{classes:'qtip-rounded qtip-shadow qtip-popup',tip:{corner:true,width:15,height:10}},position:{my:'top middle',at:'bottom middle'},content:{text:rightsTooltipText},show:{event:'click',solo:true},hide:{event:'unfocus'}});},_create:function(){var self=this;this.element.addClass('icon-shield user_list_icon_shield').attr('ariaHidden',true).attr('alt',$T('User rights')).attr('title',$T('User rights')).attr('data-id','author_'+this.options.userData.get('email')).css('color',this.options.userData.get('isSubmitter')?'#cc4646':'#aaa');var privelegeCheckboxes=[];if(this.options.submission){var submissionCheckbox=$("<input type='checkbox'>").prop('checked',!!this.options.userData.get('isSubmitter')).css('marginRight','8px').css('verticalAlign','middle');submissionCheckbox.click(function(){$('.icon-shield[data-id="author_'+self.options.userData.get('email')+'"]').trigger('participantProtChange',[{isSubmitter:submissionCheckbox.is(':checked')}]);});privelegeCheckboxes.push({'checkbox':submissionCheckbox,'text':$T("Submission rights")});}
this.element.on('participantProtChange',function(event,args){if(self.options.submission&&'isSubmitter'in args){self.element.css('color',args.isSubmitter?'#cc4646':'#aaa');self.options.userData.set('isSubmitter',args.isSubmitter);submissionCheckbox.prop('checked',args.isSubmitter);}});this._qtip(privelegeCheckboxes);}});});type("UserListWidget",["ListWidget"],{_iteratingElement:function(attrs,item){var className;var pairProperties=attrs.pair.get();if(pairProperties.get('isGroup')){className='item-group';}else if(pairProperties.get('_type')==='IPNetworkGroup'){className='icon-lan';}else if(pairProperties.get('_type')==='Email'){className='icon-mail';}else{className='icon-user';}
attrs['className']=className;delete attrs['pair'];return this.ListWidget.prototype._iteratingElement.call(this,attrs,item);},_drawItem:function(user){var self=this;var userData=user.get();var edit_button=$('<i class="edit-user icon-edit">').click(function(){var editPopup=new UserDataPopup('Change user data',userData.clone(),function(newData){self.editProcess(userData,function(result){if(result){userData.update(newData.getAll());if(!startsWith(''+userData.get('id'),'newUser')){userData.set('id','edited'+userData.get('id'));}
self.userListField.inform();}});});editPopup.open();});var remove_button=$('<i class="remove-user icon-close hide-if-locked">').click(function(){var currentUserId=$('body').data('user-id');var userId=userData.get('id');var confirmed;function setResult(result){if(result){self.set(user.key,null);self.userListField.inform();}}
if(currentUserId===userId){confirmed=confirmPrompt($T.gettext('Are you sure you want to remove yourself from the list?'),$T.gettext('Confirm action'));}else{confirmed=$.Deferred().resolve();}
confirmed.then(function(){self.removeProcess(userData,setResult);});});var buttonDiv=Html.div("actions",new Html(remove_button.get(0)));if(userData.get('isGroup')||userData.get('_fossil')==='group'){var groupName=$B(Html.span("name"),userData.accessor('name'));return[Html.span("info",groupName),buttonDiv];}else{if(IndicoGlobalVars.isUserAuthenticated&this.showToggleFavouriteButtons&&userData.get('_type')==="Avatar"){buttonDiv.append(new Html(create_favorite_button(userData.get('id')).get(0)));}
if(this.allowSetRights){buttonDiv.append($("<span></span>").shield({userData:userData}).get(0));}
if(this.allowEdit){buttonDiv.append(new Html(edit_button.get(0)));}
buttonDiv.append(new Html(remove_button.get(0)));var userName;if(userData.get('_type')=='Email'){userName=Html.span("info",$B(Html.span("name"),userData.accessor('email')));}else{userName=Html.span("info",$B(Html.span("name"),userData.accessor('name')));}
if(userData.get('_type')!=='Email'){userName.append(Html.span('email',userData.get('email')));userName.append(Html.span('affiliation',userData.get('affiliation')));}
return[userName,buttonDiv];}}},function(style,allowSetRights,allowEdit,editProcess,removeProcess,showToggleFavouriteButtons,userListField){this.style=any(style,"user-list");this.allowSetRights=allowSetRights;this.allowEdit=allowEdit;this.editProcess=any(editProcess,singleUserNothing);this.removeProcess=any(removeProcess,singleUserNothing);this.showToggleFavouriteButtons=any(showToggleFavouriteButtons,true);this.userListField=userListField;this.ListWidget(style);});type("UserListField",["IWidget"],{clear:function(){this.userList.clearList();},privilegesOn:function(){return $('#grant-manager').prop("checked")||$('#presenter-grant-submission').prop("checked");},setUpParameters:function(){this.warning_no_indico=($T("Please note that you have added a user that does not exist in Indico.\
                                    Non existing users will be asked via email to create an account so\
                                    that they will be able to use the privileges below."));this.warning_no_email=($T("Please note that you have added a user without an email address. Users without \
                                    email will not be able to use the privileges below."));this.messageDiv=$("<div/>",{css:{height:'58px',maxWidth:'420px',textAlign:'left',width:'auto',overflow:'auto',marginLeft:'5px'}}).addClass("warningMessage");this.messageContainer=$("<div/>",{css:{display:'inline-block',position:'absolute'}});this.containerDiv=$("<div/>");this.warning_flag=false;},appendMessage:function(message){this.messageDiv.html(message);this.messageContainer.append(this.messageDiv);this.containerDiv.append(this.messageContainer);this.warning_flag=true;},clearMessages:function(){this.messageContainer.html('');this.containerDiv.append(this.messageContainer);this.warning_flag=false;},checkList:function(list){var self=this;self.clearMessages();each(list,function(val,key){self.check(self.userList.get(key));});},check:function(user){var self=this;if(keys(this.privileges).length>0){if(this.privilegesOn()){if(!user.get('email')){this.appendMessage(this.warning_no_email);}
else{indicoRequest('search.users',{email:user.get('email')},function(result,error){if(!error){if(result.length==0){self.appendMessage(self.warning_no_indico);}}});}}}},inform:function(){if(keys(this.privileges).length>0){if(!this.userList.isEmpty()){this.checkList(this.userList.getAll());}
else{this.clearMessages();}}},draw:function(){var self=this;var buttonDiv=Html.div({style:{marginTop:pixels(10)}});if(this.allowSearch||this.includeFavourites||exists(this.suggestedUsers)){var chooseUserButton=Html.input("button",{style:{marginRight:pixels(5)},className:'i-button hide-if-locked',type:'button'},this.enableGroups?$T('Add User / Group'):$T('Add user'));var chooseIpNetwork=Html.a({href:'#',style:{marginRight:pixels(5)},className:'i-button arrow js-dropdown','data-toggle':'dropdown'},$T('Add IP Network'));var ipNetworksContainer=Html.span({className:'group'});var ipNetworksList=Html.ul({className:'dropdown'});_.each(this.ipNetworks,function(network){var li=Html.li();li.append(Html.a({href:'#'},network.name));li.observeClick(function(){self.newProcess([network],function(result){if(result&&!self.userList.get(network.identifier)){var entries=self.userList.getAll();entries[network.identifier]=$O(network);updatePrincipalsList(entries);}});});ipNetworksList.append(li);});ipNetworksContainer.append(chooseIpNetwork);ipNetworksContainer.append(ipNetworksList);var title;if(this.includeFavourites||exists(this.suggestedUsers)){title=this.enableGroups?$T("Add Users and Groups"):$T("Add Users");}else{title=this.enableGroups?$T("Search Users and Groups"):$T("Search Users");}
function updatePrincipalsList(entries){var sortedKeys=_.sortBy(_.keys(entries),function(key){var principal=entries[key].getAll();var weight=(principal._type=='Avatar')?0:(principal._type=='Email'?1:(principal.isGroup?2:3));var name=principal._type!=='Email'?principal.name:principal.email;return[weight,name.toLowerCase()];});self.userList.clearList();_.each(sortedKeys,function(key){self.userList.set(key,$O(entries[key].getAll()));});}
var peopleAddedHandler=function(peopleList){self.newProcess(peopleList,function(value,results){if(value){each(results,function(person){var key;if(person.isGroup||person._fossil==='group'||person._type=='IPNetworkGroup'){key=person.identifier;}else if(person._type==="Avatar"){key="existingAv"+person.id;}else if(person._type==="EventPerson"){key="existingEventPerson"+person.id;}else{key=person.id;}
if(!self.userList.get(key)){var entries=self.userList.getAll();entries[key]=$O(person);updatePrincipalsList(entries);$('.icon-shield[data-id="author_'+person.email+'"]').trigger('participantProtChange',[{isSubmitter:person.isSubmitter}]);}});}});};chooseUserButton.observeClick(function(){var chooseUsersPopup=new ChooseUsersPopup(title,self.allowSearch,self.conferenceId,self.enableGroups,self.includeFavourites,self.suggestedUsers,false,self.showToggleFavouriteButtons,self.allowSetRights,peopleAddedHandler,null,self.allowExternal);chooseUsersPopup.execute();});buttonDiv.append(chooseUserButton);if(this.enableIpNetworks){buttonDiv.append(ipNetworksContainer);}}
if(this.allowNew){var addNewUserButton=Html.input("button",{className:'i-button',style:{marginRight:pixels(5)}},$T('Add New'));addNewUserButton.observeClick(function(){var newUserId='newUser'+self.newUserCounter++;var newUser=$O({'id':newUserId});var newUserPopup=new UserDataPopup($T('New user'),newUser,function(newData){newUser.set('isSubmitter',newUser.get('submission'));self.newProcess([newUser],function(result){if(result){self.userList.set(newUserId,newUser);self.check(newUser);$('.icon-shield[data-id="author_'+newUser.get('email')+'"]').trigger('participantProtChange',[{isSubmitter:newUser.get('isSubmitter')||false}]);}});},self.allowSetRights);newUserPopup.open();});buttonDiv.append(addNewUserButton);}
var privilegesDiv=$("<span/>").css("marginTop","10px");var keysList=keys(this.privileges);if(keysList.length>0){privilegesDiv.append($("<span/>").html($T("Grant all these users with privileges: ")));}
var comma=", ";for(var i=0;i<keysList.length;i++){if(i+1==keysList.length){comma="";}
var key=keysList[i];var value=this.privileges[key];var checkbox=$('<input>',{type:"checkbox",id:key,name:key}).change(function(){if(!self.privilegesOn()){self.clearMessages();return;}
else{if(!self.warning_flag){self.inform();}}});$B(this.selectedPrivileges.accessor(key),checkbox);privilegesDiv.append($("<span/>").append(checkbox).append(value[0]+comma));}
var containsUserListDiv=$("<div/>").css("display","inline-block");containsUserListDiv.append($("<div/>").addClass(this.userDivStyle).html(this.userList.draw().dom));this.containerDiv.append(containsUserListDiv);return Widget.block([this.containerDiv.get(0),privilegesDiv.get(0),buttonDiv]);}},function(userDivStyle,userListStyle,initialUsers,includeFavourites,suggestedUsers,allowSearch,enableGroups,conferenceId,privileges,allowNew,allowSetRights,allowEdit,showToggleFavouriteButtons,newProcess,editProcess,removeProcess,allowExternal,enableIpNetworks,ipNetworks){var self=this;this.userList=new UserListWidget(userListStyle,allowSetRights,allowEdit,editProcess,removeProcess,showToggleFavouriteButtons,this);self.newUserCounter=0;this.userDivStyle=any(userDivStyle,"user-list");this.setUpParameters();if(exists(initialUsers)){each(initialUsers,function(user){if(any(user._type,null)==='Avatar'){self.userList.set('existingAv'+user.id,$O(user));}else if(user._type==='EventPerson'){self.userList.set('existingEventPerson'+user.id,$O(user));}else if(~['LDAPGroupWrapper','LocalGroupWrapper','MultipassGroup','LocalGroup','IPNetworkGroup'].indexOf(user._type)){self.userList.set(user.identifier,$O(user));}else{self.userList.set(user.id,$O(user));}});}
this.includeFavourites=any(includeFavourites,true);if(exists(suggestedUsers)){if(suggestedUsers.WatchList){this.suggestedUsers=suggestedUsers;}else{this.suggestedUsers=new WatchList();each(suggestedUsers,function(user){self.suggestedUsers.append(user);});}}else{this.suggestedUsers=null;}
this.allowSearch=any(allowSearch,true);this.enableGroups=any(enableGroups,false);this.enableIpNetworks=any(enableIpNetworks,false);this.ipNetworks=any(ipNetworks,[]);this.conferenceId=any(conferenceId,null);this.privileges=any(privileges,{});this.selectedPrivileges=new WatchObject();this.allowSetRights=allowSetRights;this.allowNew=any(allowNew,true);this.showToggleFavouriteButtons=any(showToggleFavouriteButtons,true);this.newProcess=any(newProcess,userListNothing);this.allowExternal=_.isBoolean(allowExternal)?allowExternal:true;});type("BrowserHistoryBroker",[],{addListener:function(listener){this.listeners.push(listener);listener.registerHistoryBroker(this);},setUserAction:function(hash){window.location.hash=hash;this.currentHash='#'+hash;}},function(){this.listeners=[];this.currentHash=window.location.hash;var self=this;var checkHashChanged=function(){if(self.currentHash!=window.location.hash){each(self.listeners,function(listener){listener.notifyHistoryChange(window.location.hash);});self.currentHash=window.location.hash;}};if(document.body.onhashchange!==undefined){$E(document.body).observeEvent('hashchange',checkHashChanged);}else{setInterval(checkHashChanged,500);}});Util.truncateCategPath=function(list){var first=list.slice(0,1);var last=list.length>1?list.slice(-1):[];list=list.slice(1,-1);var truncated=false;var chars=list.join('');while(chars.length>10){truncated=true;list=list.slice(1);chars=list.join('');}
if(truncated){list=concat(['...'],list);}
return translate(concat(first,list,last),function(val){return escapeHTML(val);});};$.widget('indico.dragndrop',{options:{sortableContainer:'.sortblock',sortables:'.sortblock tbody',sortableElements:'> tr',handle:'.dragHandle',placeholderClass:'dragndrop-placeholder',placeholderHTML:'<td></td>',dropTargetClass:'drop-target',noDropTargetClass:'no-drop-target',canDrop:null,onDropFail:null,onUpdate:null,onReceive:null,onReorder:null},_create:function(){var self=this;var index=null;$(self.options.sortables,self.element).sortable({connectWith:self.options.sortables,placeholder:self.options.placeholderClass,handle:self.options.handle,items:self.options.sortableElements,opacity:self.options.opacity,helper:self.options.helper,revert:self.options.revert,start:function(e,ui){index=ui.item.index();if(self.options.placeholderHTML){ui.placeholder.html(self.options.placeholderHTML);}
$(self.options.sortables,self.element).each(function(){var sortable=$(this);if(!$.isFunction(self.options.canDrop)||self.options.canDrop(sortable,$(ui.item))){sortable.closest(self.options.sortableContainer).addClass(self.options.dropTargetClass);}
else{sortable.closest(self.options.sortableContainer).addClass(self.options.noDropTargetClass);}});},stop:function(e,ui){$('.sortblock').removeClass(self.options.dropTargetClass).removeClass(self.options.noDropTargetClass);},receive:function(e,ui){if(!$(this).closest('.'+self.options.dropTargetClass).length){$(ui.sender).sortable('cancel');if($.isFunction(self.options.onDropFail)){$('.copy').remove();self.options.onDropFail.call(self.element);}}else{$('.copy').removeClass('copy');if($.isFunction(self.options.onReceive)){self.options.onReceive.call(this,ui);}}},update:function(e,ui){if($.isFunction(self.options.onUpdate)){self.options.onUpdate.call(self.element);}},beforeStop:function(e,ui){if(ui.item.parent().get(0)==this){if($.isFunction(self.options.onReorder)){self.options.onReorder.call(this,ui);}}},over:function(e,ui){$('.copy').remove();var modeCopy=eval($(this).data('modeCopy'));if(ui.sender.get(0)!=this&&$.inArray(ui.sender.attr('id'),modeCopy)!=-1){var clonedItem=ui.item.clone();clonedItem.addClass("copy").attr('style','').insertAfter(ui.sender.find(self.options.sortableElements+":eq("+index+")")).fadeIn("slow");clonedItem.data('user',ui.item.data('user'));}}});},destroy:function(){var self=this;$(self.options.sortables,self.element).sortable('destroy');$.Widget.prototype.destroy.apply(this,arguments);},serialize:function(){var self=this;var order={};$(self.options.sortables,self.element).each(function(){var container=$(this).closest(self.options.sortableContainer);var id=container.data('id');order[id]=[];$(self.options.sortableElements,this).each(function(){var elem=$(this);order[id].push(elem.data('id'));});});return order;}});var K={'SPACE':32,'ENTER':13,'TAB':9,'BACKSPACE':8,'SHIFT':16,'CTRL':17,'ALT':18,'CAPS_LOCK':20,'NUM_LOCK':144,'SCROLL_LOCK':145,'LEFT':37,'UP':38,'RIGHT':39,'DOWN':40,'PAGE_UP':33,'PAGE_DOWN':34,'HOME':36,'END':35,'INSERT':45,'DELETE':46,'ESCAPE':27,'PAUSE':19,"'":222};